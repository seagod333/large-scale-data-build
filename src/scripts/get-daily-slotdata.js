#!/usr/bin/env ts-node
'use strict';var __importDefault=this&&this['__importDefault']||function(_0x9b87a9){return _0x9b87a9&&_0x9b87a9['__esModule']?_0x9b87a9:{'default':_0x9b87a9};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),logger_1=require('../utils/logger'),get_store_masters_1=__importDefault(require('../min-repo/services/get-store-masters')),get_daily_slotdata_1=__importDefault(require('../min-repo/services/get-daily-slotdata')),getDailySlotDataFunction=async(_0x764ab='',_0x931793=0x14)=>{const _0xda002b=new Date();try{logger_1['logger']['info']('Starting\x20getDailySlotData\x20function...'),logger_1['logger']['info']('Target\x20date:\x20'+(_0x764ab||'current\x20date')),logger_1['logger']['info']('Phase\x201:\x20Extracting\x20store\x20masters...');const _0x408224=new Date(),_0x1bb31a=await get_store_masters_1['default']['extractData'](_0x764ab),_0x24788e=new Date(),_0x38de4c=_0x24788e['getTime']()-_0x408224['getTime']();logger_1['logger']['info']('Store\x20extraction\x20completed\x20in\x20'+(_0x38de4c/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Extracted\x20'+_0x1bb31a['length']+'\x20store\x20masters'),_0x931793=Math['floor'](_0x1bb31a['length']/0xc);const _0x2fc1ce=_0x1bb31a['slice'](0x0,_0x931793);_0x2fc1ce['length']<_0x1bb31a['length']&&logger_1['logger']['info']('Limited\x20to\x20first\x20'+_0x931793+'\x20stores\x20for\x20processing');if(_0x2fc1ce['length']===0x0){logger_1['logger']['warn']('No\x20stores\x20found\x20for\x20processing');const _0x251669=new Date(),_0x4f7b61=_0x251669['getTime']()-_0xda002b['getTime']();logger_1['logger']['info']('Saving\x20empty\x20daily\x20data\x20to\x20JSON\x20file...');const _0x32cc6e=path_1['default']['join'](process['cwd'](),'output');!fs_1['default']['existsSync'](_0x32cc6e)&&(fs_1['default']['mkdirSync'](_0x32cc6e,{'recursive':!![]}),logger_1['logger']['info']('Created\x20output\x20directory:\x20'+_0x32cc6e));const _0x3b345a={'extractionDate':_0x764ab||new Date()['toISOString']()['split']('T')[0x0],'extractionTimestamp':new Date()['toISOString'](),'summary':{'totalStores':0x0,'totalMachineModels':0x0,'totalSlotDataRows':0x0,'processingTime':{'totalDurationMs':_0x4f7b61,'totalDurationSeconds':(_0x4f7b61/0x3e8)['toFixed'](0x2),'storeExtractionDurationMs':_0x38de4c,'dailySlotExtractionDurationMs':0x0}},'storeMasters':[],'machineModels':[],'slotDatas':[]},_0x5258da=path_1['default']['join'](_0x32cc6e,'dailydata.json');return fs_1['default']['writeFileSync'](_0x5258da,JSON['stringify'](_0x3b345a,null,0x2),'utf8'),logger_1['logger']['info']('Empty\x20daily\x20data\x20saved\x20to:\x20'+_0x5258da),{'storeMasters':[],'machineModels':[],'slotDatas':[],'timestamps':{'totalStartTime':_0xda002b,'totalEndTime':_0x251669,'totalDurationMs':_0x4f7b61,'storeExtractionStartTime':_0x408224,'storeExtractionEndTime':_0x24788e,'storeExtractionDurationMs':_0x38de4c,'dailySlotExtractionStartTime':_0x24788e,'dailySlotExtractionEndTime':_0x24788e,'dailySlotExtractionDurationMs':0x0,'machineModelExtractionDurationMs':0x0,'slotDataExtractionDurationMs':0x0}};}logger_1['logger']['info']('Phase\x202:\x20Extracting\x20daily\x20slot\x20data...');const _0xb4feec=new Date(),[_0x3ad852,_0x2d7042]=await get_daily_slotdata_1['default']['extraDatas'](_0x2fc1ce,_0x764ab),_0x59d882=new Date(),_0x9e838a=_0x59d882['getTime']()-_0xb4feec['getTime']();logger_1['logger']['info']('Daily\x20slot\x20extraction\x20completed\x20in\x20'+(_0x9e838a/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Extracted\x20'+_0x3ad852['length']+'\x20machine\x20models'),logger_1['logger']['info']('Extracted\x20'+_0x2d7042['length']+'\x20slot\x20data\x20rows');const _0x128309=new Date(),_0x3182e2=_0x128309['getTime']()-_0xda002b['getTime'](),_0x4b0dcd=Math['floor'](_0x9e838a*0.3),_0x245132=Math['floor'](_0x9e838a*0.7);logger_1['logger']['info']('===\x20EXTRACTION\x20SUMMARY\x20==='),logger_1['logger']['info']('Total\x20duration:\x20'+(_0x3182e2/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Store\x20extraction:\x20'+(_0x38de4c/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Daily\x20slot\x20extraction:\x20'+(_0x9e838a/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('-\x20Machine\x20model\x20extraction:\x20~'+(_0x4b0dcd/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('-\x20Slot\x20data\x20extraction:\x20~'+(_0x245132/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Results:\x20'+_0x1bb31a['length']+'\x20stores,\x20'+_0x3ad852['length']+'\x20models,\x20'+_0x2d7042['length']+'\x20slot\x20rows'),logger_1['logger']['info']('Saving\x20daily\x20data\x20to\x20JSON\x20file...');const _0x14951b=path_1['default']['join'](process['cwd'](),'output');!fs_1['default']['existsSync'](_0x14951b)&&(fs_1['default']['mkdirSync'](_0x14951b,{'recursive':!![]}),logger_1['logger']['info']('Created\x20output\x20directory:\x20'+_0x14951b));const _0x5e55a9={'extractionDate':_0x764ab||new Date()['toISOString']()['split']('T')[0x0],'extractionTimestamp':new Date()['toISOString'](),'summary':{'totalStores':_0x2fc1ce['length'],'totalMachineModels':_0x3ad852['length'],'totalSlotDataRows':_0x2d7042['length'],'processingTime':{'totalDurationMs':_0x3182e2,'totalDurationSeconds':(_0x3182e2/0x3e8)['toFixed'](0x2),'storeExtractionDurationMs':_0x38de4c,'dailySlotExtractionDurationMs':_0x9e838a}},'storeMasters':_0x2fc1ce,'machineModels':_0x3ad852,'slotDatas':_0x2d7042},_0xb7d32=path_1['default']['join'](_0x14951b,'dailydata.json');return fs_1['default']['writeFileSync'](_0xb7d32,JSON['stringify'](_0x5e55a9,null,0x2),'utf8'),logger_1['logger']['info']('Daily\x20data\x20saved\x20to:\x20'+_0xb7d32),logger_1['logger']['info']('File\x20size:\x20'+(fs_1['default']['statSync'](_0xb7d32)['size']/0x400)['toFixed'](0x2)+'\x20KB'),{'storeMasters':_0x2fc1ce,'machineModels':_0x3ad852,'slotDatas':_0x2d7042,'timestamps':{'totalStartTime':_0xda002b,'totalEndTime':_0x128309,'totalDurationMs':_0x3182e2,'storeExtractionStartTime':_0x408224,'storeExtractionEndTime':_0x24788e,'storeExtractionDurationMs':_0x38de4c,'dailySlotExtractionStartTime':_0xb4feec,'dailySlotExtractionEndTime':_0x59d882,'dailySlotExtractionDurationMs':_0x9e838a,'machineModelExtractionDurationMs':_0x4b0dcd,'slotDataExtractionDurationMs':_0x245132}};}catch(_0x5c4a9f){const _0x441bff=new Date(),_0x4f0c7b=_0x441bff['getTime']()-_0xda002b['getTime']();logger_1['logger']['error']('Failed\x20to\x20get\x20daily\x20slot\x20data:\x20'+_0x5c4a9f['message']),logger_1['logger']['error']('Process\x20failed\x20after\x20'+(_0x4f0c7b/0x3e8)['toFixed'](0x2)+'s');throw new Error('getDailySlotData\x20function\x20failed:\x20'+_0x5c4a9f['message']);}},testGetDailySlotDataFunction=async()=>{try{logger_1['logger']['info']('Starting\x20getDailySlotDataFunction\x20test...');const _0x466114='2025-09-24',_0x677cd4=0x5;logger_1['logger']['info']('Testing\x20with\x20date:\x20'+_0x466114);const _0x4dbb1e=await getDailySlotDataFunction(_0x466114,_0x677cd4);logger_1['logger']['info']('===\x20EXTRACTION\x20RESULTS\x20==='),logger_1['logger']['info']('Store\x20Masters:\x20'+_0x4dbb1e['storeMasters']['length']),logger_1['logger']['info']('Machine\x20Models:\x20'+_0x4dbb1e['machineModels']['length']),logger_1['logger']['info']('Slot\x20Data\x20Rows:\x20'+_0x4dbb1e['slotDatas']['length']),logger_1['logger']['info']('===\x20TIMING\x20INFORMATION\x20==='),logger_1['logger']['info']('Total\x20Duration:\x20'+(_0x4dbb1e['timestamps']['totalDurationMs']/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Store\x20Extraction:\x20'+(_0x4dbb1e['timestamps']['storeExtractionDurationMs']/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('Daily\x20Slot\x20Extraction:\x20'+(_0x4dbb1e['timestamps']['dailySlotExtractionDurationMs']/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('-\x20Machine\x20Model\x20Extraction:\x20~'+(_0x4dbb1e['timestamps']['machineModelExtractionDurationMs']/0x3e8)['toFixed'](0x2)+'s'),logger_1['logger']['info']('-\x20Slot\x20Data\x20Extraction:\x20~'+(_0x4dbb1e['timestamps']['slotDataExtractionDurationMs']/0x3e8)['toFixed'](0x2)+'s'),_0x4dbb1e['storeMasters']['length']>0x0&&(logger_1['logger']['info']('===\x20SAMPLE\x20STORE\x20MASTERS\x20==='),_0x4dbb1e['storeMasters']['slice'](0x0,0x3)['forEach']((_0x25c6e5,_0x40475d)=>{logger_1['logger']['info'](_0x40475d+0x1+'.\x20'+_0x25c6e5['store_name']+'\x20('+_0x25c6e5['p_name']+')\x20-\x20'+_0x25c6e5['store_url']);})),_0x4dbb1e['machineModels']['length']>0x0&&(logger_1['logger']['info']('===\x20SAMPLE\x20MACHINE\x20MODELS\x20==='),_0x4dbb1e['machineModels']['slice'](0x0,0x5)['forEach']((_0x4c0298,_0x595776)=>{logger_1['logger']['info'](_0x595776+0x1+'.\x20'+_0x4c0298['machine_name']+'\x20at\x20'+_0x4c0298['store_name']+'\x20('+_0x4c0298['p_name']+')');})),_0x4dbb1e['slotDatas']['length']>0x0&&(logger_1['logger']['info']('===\x20SAMPLE\x20SLOT\x20DATA\x20==='),_0x4dbb1e['slotDatas']['slice'](0x0,0x3)['forEach']((_0x306ec1,_0x345a5c)=>{logger_1['logger']['info'](_0x345a5c+0x1+'.\x20'+_0x306ec1['store_name']+'\x20-\x20'+_0x306ec1['machine_name']+'\x20#'+_0x306ec1['machine_number']+'\x20(G:\x20'+_0x306ec1['game_count']+',\x20BB:\x20'+_0x306ec1['bb']+',\x20RB:\x20'+_0x306ec1['rb']+')');})),logger_1['logger']['info']('Test\x20completed\x20successfully!'),logger_1['logger']['info']('Daily\x20data\x20has\x20been\x20saved\x20to:\x20output/dailydata.json');}catch(_0x3c5ecd){logger_1['logger']['error']('Test\x20failed:\x20'+_0x3c5ecd['message']),process['exit'](0x1);}};testGetDailySlotDataFunction();