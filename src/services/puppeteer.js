'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2c9ebc,_0xc2d839,_0x5bb6b2,_0x3089a9){if(_0x3089a9===undefined)_0x3089a9=_0x5bb6b2;var _0x779559=Object['getOwnPropertyDescriptor'](_0xc2d839,_0x5bb6b2);(!_0x779559||('get'in _0x779559?!_0xc2d839['__esModule']:_0x779559['writable']||_0x779559['configurable']))&&(_0x779559={'enumerable':!![],'get':function(){return _0xc2d839[_0x5bb6b2];}}),Object['defineProperty'](_0x2c9ebc,_0x3089a9,_0x779559);}:function(_0x328742,_0x23a2f4,_0x51dacd,_0x1cd45a){if(_0x1cd45a===undefined)_0x1cd45a=_0x51dacd;_0x328742[_0x1cd45a]=_0x23a2f4[_0x51dacd];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x59e486,_0x18a000){Object['defineProperty'](_0x59e486,'default',{'enumerable':!![],'value':_0x18a000});}:function(_0x327974,_0x519996){_0x327974['default']=_0x519996;}),__importStar=this&&this['__importStar']||function(_0x34c5eb){if(_0x34c5eb&&_0x34c5eb['__esModule'])return _0x34c5eb;var _0x211c21={};if(_0x34c5eb!=null){for(var _0x2f3a90 in _0x34c5eb)if(_0x2f3a90!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x34c5eb,_0x2f3a90))__createBinding(_0x211c21,_0x34c5eb,_0x2f3a90);}return __setModuleDefault(_0x211c21,_0x34c5eb),_0x211c21;},__importDefault=this&&this['__importDefault']||function(_0x1561b9){return _0x1561b9&&_0x1561b9['__esModule']?_0x1561b9:{'default':_0x1561b9};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require('path')),puppeteer_real_browser_1=__importDefault(require('puppeteer-real-browser')),puppeteer_cluster_1=require('puppeteer-cluster'),utils_1=require('../utils'),logger_1=require('../utils/logger'),customError_1=require('../@types/customError'),config_1=__importDefault(require('../config/config')),viewport={'width':0x640,'height':0x384},setupRequestInterception=async _0x3fbfc8=>{try{await _0x3fbfc8['setRequestInterception'](!![]),_0x3fbfc8['removeAllListeners']('request'),_0x3fbfc8['on']('request',_0x2d79bb=>{const _0x57bc46=['image','stylesheet','font'];if(_0x57bc46['includes'](_0x2d79bb['resourceType']()))return _0x2d79bb['abort']();return _0x2d79bb['continue']();});}catch(_0x125a2d){logger_1['logger']['warn']('Failed\x20to\x20set\x20up\x20request\x20interception:\x20'+_0x125a2d['message']);}},saveCookies=async(_0x3a401b,_0x2592cc)=>{try{const _0xcd5b55=await _0x3a401b['cookies'](),_0x51e2eb=JSON['stringify'](_0xcd5b55,null,0x2),_0x2af539=path['dirname'](_0x2592cc);!fs['existsSync'](_0x2af539)&&fs['mkdirSync'](_0x2af539,{'recursive':!![]}),fs['writeFileSync'](_0x2592cc,_0x51e2eb);}catch(_0x19de52){logger_1['logger']['error']('Error\x20saving\x20cookies:\x20'+_0x19de52['message']);}},loadCookies=async(_0x38b53e,_0x50b7b0)=>{try{if(!!fs['existsSync'](_0x50b7b0)){const _0x5e821f=fs['readFileSync'](_0x50b7b0,'utf8'),_0xbfebc8=JSON['parse'](_0x5e821f);await _0x38b53e['setCookie'](..._0xbfebc8);}}catch(_0x2c075d){logger_1['logger']['error']('Error\x20loading\x20cookies:\x20'+_0x2c075d['message']);}},saveLocalStorage=async(_0x21f2ce,_0x116746)=>{try{const _0x2ca2a7=await _0x21f2ce['evaluate'](()=>{try{if(typeof window['localStorage']==='undefined')return logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x5dd504={};for(let _0x18593e=0x0;_0x18593e<window['localStorage']['length'];_0x18593e++){const _0x5ecf79=window['localStorage']['key'](_0x18593e);_0x5ecf79&&(_0x5dd504[_0x5ecf79]=window['localStorage']['getItem'](_0x5ecf79)||'');}return _0x5dd504;}catch(_0x6f3051){return logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x6f3051['message']),{};}}),_0x28a16c=path['dirname'](_0x116746);!fs['existsSync'](_0x28a16c)&&fs['mkdirSync'](_0x28a16c,{'recursive':!![]}),fs['writeFileSync'](_0x116746,JSON['stringify'](_0x2ca2a7,null,0x2));}catch(_0x585657){logger_1['logger']['warn']('Could\x20not\x20save\x20local\x20storage\x20to\x20'+_0x116746+':\x20'+_0x585657['message']);}},loadLocalStorage=async(_0x5c3150,_0x307c66)=>{try{if(!!fs['existsSync'](_0x307c66)){const _0x56f8bf=fs['readFileSync'](_0x307c66,'utf8'),_0x7583d=JSON['parse'](_0x56f8bf);await _0x5c3150['evaluate'](_0x23ccc4=>{try{if(typeof window['localStorage']==='undefined'){logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x11bfe8,_0x274052]of Object['entries'](_0x23ccc4)){window['localStorage']['setItem'](_0x11bfe8,_0x274052);}}catch(_0x3b430b){logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x3b430b['message']);}},_0x7583d);}}catch(_0x413768){logger_1['logger']['warn']('Could\x20not\x20load\x20local\x20storage\x20from\x20'+_0x307c66+':\x20'+_0x413768['message']);}},saveSessionStorage=async(_0x1d7ae7,_0x3fa4f5)=>{try{const _0x3f8dc7=await _0x1d7ae7['evaluate'](()=>{try{if(typeof window['sessionStorage']==='undefined')return logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x1eb06d={};for(let _0x2e899a=0x0;_0x2e899a<window['sessionStorage']['length'];_0x2e899a++){const _0x52dc3a=window['sessionStorage']['key'](_0x2e899a);_0x52dc3a&&(_0x1eb06d[_0x52dc3a]=window['sessionStorage']['getItem'](_0x52dc3a)||'');}return _0x1eb06d;}catch(_0x309927){return logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x309927['message']),{};}}),_0x57979d=path['dirname'](_0x3fa4f5);!fs['existsSync'](_0x57979d)&&fs['mkdirSync'](_0x57979d,{'recursive':!![]}),fs['writeFileSync'](_0x3fa4f5,JSON['stringify'](_0x3f8dc7,null,0x2));}catch(_0x2a415b){logger_1['logger']['warn']('Could\x20not\x20save\x20session\x20storage\x20to\x20'+_0x3fa4f5+':\x20'+_0x2a415b['message']);}},loadSessionStorage=async(_0x57cd6c,_0x1f8a49)=>{try{if(!!fs['existsSync'](_0x1f8a49)){const _0x2015d6=fs['readFileSync'](_0x1f8a49,'utf8'),_0x6b34e3=JSON['parse'](_0x2015d6);await _0x57cd6c['evaluate'](_0x553bb6=>{try{if(typeof window['sessionStorage']==='undefined'){logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x476013,_0x51cd38]of Object['entries'](_0x553bb6)){window['sessionStorage']['setItem'](_0x476013,_0x51cd38);}}catch(_0x28a4a5){logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x28a4a5['message']);}},_0x6b34e3);}}catch(_0xd4f895){logger_1['logger']['warn']('Could\x20not\x20load\x20session\x20storage\x20from\x20'+_0x1f8a49+':\x20'+_0xd4f895['message']);}},puppeteerBrowser={'getBrowser':async()=>{const _0x8e8e61=config_1['default']['browser'];_0x8e8e61['dataDir']&&(!fs['existsSync'](_0x8e8e61['dataDir'])&&fs['mkdirSync'](_0x8e8e61['dataDir'],{'recursive':!![]}));const {browser:_0x4a89b5,page:_0x27489b}=await puppeteer_real_browser_1['default']['connect']({'args':['--disable-gpu','--disable-images','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled',..._0x8e8e61['dataDir']?['--user-data-dir='+_0x8e8e61['dataDir']]:[]],'headless':_0x8e8e61['headless'],'customConfig':{},'turnstile':_0x8e8e61['turnstile'],'connectOption':{'protocolTimeout':0x186a0},'disableXvfb':!![],'ignoreAllFlags':!![]});return await _0x27489b['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x27489b),{'browser':_0x4a89b5,'page':_0x27489b};},'getPage':async _0x529c93=>{const _0x4db803=await _0x529c93['newPage']();return await _0x4db803['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x4db803),_0x4db803;},'navigation':async(_0x191a5a,_0x275729,_0x5d3b1d=0x5)=>{let _0x322717=0x0,_0xa701e2=![];while(!_0xa701e2&&_0x322717<_0x5d3b1d){try{await _0x191a5a['goto'](_0x275729,{'waitUntil':'domcontentloaded','timeout':0x1e*0x3e8}),_0xa701e2=!![];}catch(_0x2ab6e9){_0x322717++;if(_0x322717>=_0x5d3b1d)throw new customError_1['SystemError']('Failed\x20to\x20navigate\x20to\x20'+_0x275729+'\x20after\x20'+_0x5d3b1d+'\x20attempts:\x20'+_0x2ab6e9['message']);else logger_1['logger']['warn']('Navigation\x20attempt\x20'+_0x322717+'\x20failed:\x20'+_0x2ab6e9['message']+'.\x20Retrying...');await(0x0,utils_1['sleep'])(0x5*0x3e8);}}return _0xa701e2;},'loadBrowserState':async _0x3eef5f=>{try{const _0x155017=config_1['default']['browser'];if(!fs['existsSync'](_0x155017['dataDir']))throw new customError_1['ValidateError']('directory\x20not\x20found:\x20'+_0x155017['dataDir']);await Promise['all']([loadCookies(_0x3eef5f,path['join'](_0x155017['dataDir'],'cookies.json')),loadLocalStorage(_0x3eef5f,path['join'](_0x155017['dataDir'],'localStorage.json')),loadSessionStorage(_0x3eef5f,path['join'](_0x155017['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Browser\x20state\x20loaded\x20from:\x20'+_0x155017['dataDir']);}catch(_0x3344ef){logger_1['logger']['error']('Error\x20loading\x20browser\x20state:\x20'+_0x3344ef['message']);}},'saveBrowserState':async _0x410b87=>{try{const _0x880db7=config_1['default']['browser'];!fs['existsSync'](_0x880db7['dataDir'])&&fs['mkdirSync'](_0x880db7['dataDir'],{'recursive':!![]}),await Promise['all']([saveCookies(_0x410b87,path['join'](_0x880db7['dataDir'],'cookies.json')),saveLocalStorage(_0x410b87,path['join'](_0x880db7['dataDir'],'localStorage.json')),saveSessionStorage(_0x410b87,path['join'](_0x880db7['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Complete\x20browser\x20state\x20saved\x20to:\x20'+_0x880db7['dataDir']);}catch(_0x1d62e9){logger_1['logger']['error']('Error\x20saving\x20browser\x20state:\x20'+_0x1d62e9['message']);}},'takeScreenshot':async(_0x3d134a,_0x52ce9e,_0xe1a506)=>{try{const _0x381b48=path['dirname'](_0x52ce9e);!fs['existsSync'](_0x381b48)&&fs['mkdirSync'](_0x381b48,{'recursive':!![]}),await _0x3d134a['screenshot']({'path':_0x52ce9e,'fullPage':_0xe1a506?.['fullPage']||![]}),logger_1['logger']['info']('Screenshot\x20saved\x20to:\x20'+_0x52ce9e);}catch(_0x2ed405){logger_1['logger']['error']('Error\x20taking\x20screenshot:\x20'+_0x2ed405['message']);}},'createCluster':async _0x3a0d12=>{const _0x4cf94f=config_1['default']['browser'],_0x524e77=Math['max'](0x1,Number(_0x3a0d12?.['maxConcurrency']||config_1['default']['maxthreads'])||0x1),_0x5d2eb8=await puppeteer_cluster_1['Cluster']['launch']({'concurrency':puppeteer_cluster_1['Cluster']['CONCURRENCY_PAGE'],'maxConcurrency':_0x524e77,'timeout':0x3c*0x3e8,'retryDelay':0x64,'monitor':![],'puppeteerOptions':{'headless':_0x3a0d12?.['headless']??_0x4cf94f['headless'],'args':['--disable-gpu','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled','--no-sandbox','--disable-setuid-sandbox',..._0x4cf94f['dataDir']?['--user-data-dir='+_0x4cf94f['dataDir']]:[]],'executablePath':_0x4cf94f['executablePath']||undefined,'defaultViewport':{'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}}});return _0x5d2eb8;},'withCluster':async(_0x5b6ffb,_0x4a9fc4,_0x2b9ee0)=>{const _0x1f27b3=await puppeteerBrowser['createCluster'](_0x2b9ee0);try{await _0x1f27b3['task'](async({page:_0x145d49,data:_0x5a4347})=>{try{config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x145d49),await _0x145d49['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1});}catch(_0x427834){logger_1['logger']['warn']('Cluster\x20page\x20setup\x20failed:\x20'+_0x427834['message']);}try{return await _0x4a9fc4({'page':_0x145d49,'data':_0x5a4347});}catch(_0x3d5c95){return logger_1['logger']['error']('Task\x20failed\x20for\x20item:\x20'+JSON['stringify'](_0x5a4347)+'\x20-\x20'+_0x3d5c95['message']),null;}});const _0x3bbc63=[];for(const _0x3bf9b9 of _0x5b6ffb){_0x3bbc63['push'](_0x1f27b3['execute'](_0x3bf9b9));}const _0x516648=await Promise['allSettled'](_0x3bbc63),_0x196073=_0x516648['filter'](_0x2d84e3=>_0x2d84e3['status']==='fulfilled')['map'](_0x3c0ab5=>_0x3c0ab5['value'])['filter'](_0x2ec243=>_0x2ec243!==null&&_0x2ec243!==undefined);return await _0x1f27b3['idle'](),_0x196073;}catch(_0x47504f){return logger_1['logger']['error']('Failed\x20to\x20execute\x20cluster:\x20'+_0x47504f['message']),[];}finally{await _0x1f27b3['close']();}}};exports['default']=puppeteerBrowser;