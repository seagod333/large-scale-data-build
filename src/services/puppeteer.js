'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3d92f3,_0x607791,_0x92a469,_0x4533d4){if(_0x4533d4===undefined)_0x4533d4=_0x92a469;var _0x551260=Object['getOwnPropertyDescriptor'](_0x607791,_0x92a469);(!_0x551260||('get'in _0x551260?!_0x607791['__esModule']:_0x551260['writable']||_0x551260['configurable']))&&(_0x551260={'enumerable':!![],'get':function(){return _0x607791[_0x92a469];}}),Object['defineProperty'](_0x3d92f3,_0x4533d4,_0x551260);}:function(_0x5b4bea,_0x5745a9,_0x45fb90,_0x5bb839){if(_0x5bb839===undefined)_0x5bb839=_0x45fb90;_0x5b4bea[_0x5bb839]=_0x5745a9[_0x45fb90];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x4a60dc,_0x31f20c){Object['defineProperty'](_0x4a60dc,'default',{'enumerable':!![],'value':_0x31f20c});}:function(_0x5b36a1,_0x2646a8){_0x5b36a1['default']=_0x2646a8;}),__importStar=this&&this['__importStar']||function(_0x302440){if(_0x302440&&_0x302440['__esModule'])return _0x302440;var _0x469692={};if(_0x302440!=null){for(var _0x45ae79 in _0x302440)if(_0x45ae79!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x302440,_0x45ae79))__createBinding(_0x469692,_0x302440,_0x45ae79);}return __setModuleDefault(_0x469692,_0x302440),_0x469692;},__importDefault=this&&this['__importDefault']||function(_0xceccda){return _0xceccda&&_0xceccda['__esModule']?_0xceccda:{'default':_0xceccda};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require('path')),puppeteer_real_browser_1=__importDefault(require('puppeteer-real-browser')),puppeteer_cluster_1=require('puppeteer-cluster'),utils_1=require('../utils'),logger_1=require('../utils/logger'),customError_1=require('../@types/customError'),config_1=__importDefault(require('../config/config')),viewport={'width':0x640,'height':0x384},setupRequestInterception=async _0x4dea16=>{try{await _0x4dea16['setRequestInterception'](!![]),_0x4dea16['removeAllListeners']('request'),_0x4dea16['on']('request',_0x74a81b=>{const _0x516505=['image','stylesheet','font'];if(_0x516505['includes'](_0x74a81b['resourceType']()))return _0x74a81b['abort']();return _0x74a81b['continue']();});}catch(_0x51c88a){logger_1['logger']['warn']('Failed\x20to\x20set\x20up\x20request\x20interception:\x20'+_0x51c88a['message']);}},saveCookies=async(_0x1357c6,_0x95e8d5)=>{try{const _0x41755a=await _0x1357c6['cookies'](),_0x5e88b9=JSON['stringify'](_0x41755a,null,0x2),_0x5579d9=path['dirname'](_0x95e8d5);!fs['existsSync'](_0x5579d9)&&fs['mkdirSync'](_0x5579d9,{'recursive':!![]}),fs['writeFileSync'](_0x95e8d5,_0x5e88b9);}catch(_0x509b54){logger_1['logger']['error']('Error\x20saving\x20cookies:\x20'+_0x509b54['message']);}},loadCookies=async(_0x354bf3,_0x258bea)=>{try{if(!!fs['existsSync'](_0x258bea)){const _0x18dc27=fs['readFileSync'](_0x258bea,'utf8'),_0x451ad6=JSON['parse'](_0x18dc27);await _0x354bf3['setCookie'](..._0x451ad6);}}catch(_0x340949){logger_1['logger']['error']('Error\x20loading\x20cookies:\x20'+_0x340949['message']);}},saveLocalStorage=async(_0x4e65b4,_0x1e13d0)=>{try{const _0x390789=await _0x4e65b4['evaluate'](()=>{try{if(typeof window['localStorage']==='undefined')return logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x63aa5a={};for(let _0x13a792=0x0;_0x13a792<window['localStorage']['length'];_0x13a792++){const _0x23f8c9=window['localStorage']['key'](_0x13a792);_0x23f8c9&&(_0x63aa5a[_0x23f8c9]=window['localStorage']['getItem'](_0x23f8c9)||'');}return _0x63aa5a;}catch(_0x319948){return logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x319948['message']),{};}}),_0xe521e9=path['dirname'](_0x1e13d0);!fs['existsSync'](_0xe521e9)&&fs['mkdirSync'](_0xe521e9,{'recursive':!![]}),fs['writeFileSync'](_0x1e13d0,JSON['stringify'](_0x390789,null,0x2));}catch(_0x2472a8){logger_1['logger']['warn']('Could\x20not\x20save\x20local\x20storage\x20to\x20'+_0x1e13d0+':\x20'+_0x2472a8['message']);}},loadLocalStorage=async(_0x23fcfb,_0x56ed0f)=>{try{if(!!fs['existsSync'](_0x56ed0f)){const _0x351e03=fs['readFileSync'](_0x56ed0f,'utf8'),_0x39ca21=JSON['parse'](_0x351e03);await _0x23fcfb['evaluate'](_0x480a6c=>{try{if(typeof window['localStorage']==='undefined'){logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x39d4e7,_0x2602c8]of Object['entries'](_0x480a6c)){window['localStorage']['setItem'](_0x39d4e7,_0x2602c8);}}catch(_0x31f0ea){logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x31f0ea['message']);}},_0x39ca21);}}catch(_0x25325b){logger_1['logger']['warn']('Could\x20not\x20load\x20local\x20storage\x20from\x20'+_0x56ed0f+':\x20'+_0x25325b['message']);}},saveSessionStorage=async(_0x1fcda5,_0x423eed)=>{try{const _0x3ec26c=await _0x1fcda5['evaluate'](()=>{try{if(typeof window['sessionStorage']==='undefined')return logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x43af09={};for(let _0x23725f=0x0;_0x23725f<window['sessionStorage']['length'];_0x23725f++){const _0x242b3b=window['sessionStorage']['key'](_0x23725f);_0x242b3b&&(_0x43af09[_0x242b3b]=window['sessionStorage']['getItem'](_0x242b3b)||'');}return _0x43af09;}catch(_0x4dbb6e){return logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x4dbb6e['message']),{};}}),_0x218354=path['dirname'](_0x423eed);!fs['existsSync'](_0x218354)&&fs['mkdirSync'](_0x218354,{'recursive':!![]}),fs['writeFileSync'](_0x423eed,JSON['stringify'](_0x3ec26c,null,0x2));}catch(_0x6ccae5){logger_1['logger']['warn']('Could\x20not\x20save\x20session\x20storage\x20to\x20'+_0x423eed+':\x20'+_0x6ccae5['message']);}},loadSessionStorage=async(_0x14288f,_0x5ddcd1)=>{try{if(!!fs['existsSync'](_0x5ddcd1)){const _0x4e5df5=fs['readFileSync'](_0x5ddcd1,'utf8'),_0x24e6b1=JSON['parse'](_0x4e5df5);await _0x14288f['evaluate'](_0x243ad9=>{try{if(typeof window['sessionStorage']==='undefined'){logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x19e01a,_0x22f4be]of Object['entries'](_0x243ad9)){window['sessionStorage']['setItem'](_0x19e01a,_0x22f4be);}}catch(_0x5dce4f){logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x5dce4f['message']);}},_0x24e6b1);}}catch(_0x4a2f59){logger_1['logger']['warn']('Could\x20not\x20load\x20session\x20storage\x20from\x20'+_0x5ddcd1+':\x20'+_0x4a2f59['message']);}},puppeteerBrowser={'getBrowser':async()=>{const _0x5c6d86=config_1['default']['browser'];_0x5c6d86['dataDir']&&(!fs['existsSync'](_0x5c6d86['dataDir'])&&fs['mkdirSync'](_0x5c6d86['dataDir'],{'recursive':!![]}));const {browser:_0x2de90c,page:_0x51b268}=await puppeteer_real_browser_1['default']['connect']({'args':['--disable-gpu','--disable-images','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled',..._0x5c6d86['dataDir']?['--user-data-dir='+_0x5c6d86['dataDir']]:[]],'headless':_0x5c6d86['headless'],'customConfig':{},'turnstile':_0x5c6d86['turnstile'],'connectOption':{'protocolTimeout':0x186a0},'disableXvfb':!![],'ignoreAllFlags':!![]});return await _0x51b268['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x51b268),{'browser':_0x2de90c,'page':_0x51b268};},'getPage':async _0x54a0f6=>{const _0x5e5d23=await _0x54a0f6['newPage']();return await _0x5e5d23['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x5e5d23),_0x5e5d23;},'navigation':async(_0x56c6f5,_0x30e2f7,_0x2749bd=0x5)=>{let _0x3e866b=0x0,_0x405696=![];while(!_0x405696&&_0x3e866b<_0x2749bd){try{await _0x56c6f5['goto'](_0x30e2f7,{'waitUntil':'domcontentloaded','timeout':0x1e*0x3e8}),_0x405696=!![];}catch(_0x1e703f){_0x3e866b++;if(_0x3e866b>=_0x2749bd)throw new customError_1['SystemError']('Failed\x20to\x20navigate\x20to\x20'+_0x30e2f7+'\x20after\x20'+_0x2749bd+'\x20attempts:\x20'+_0x1e703f['message']);else logger_1['logger']['warn']('Navigation\x20attempt\x20'+_0x3e866b+'\x20failed:\x20'+_0x1e703f['message']+'.\x20Retrying...');await(0x0,utils_1['sleep'])(0x5*0x3e8);}}return _0x405696;},'loadBrowserState':async _0x248238=>{try{const _0x1884ad=config_1['default']['browser'];if(!fs['existsSync'](_0x1884ad['dataDir']))throw new customError_1['ValidateError']('directory\x20not\x20found:\x20'+_0x1884ad['dataDir']);await Promise['all']([loadCookies(_0x248238,path['join'](_0x1884ad['dataDir'],'cookies.json')),loadLocalStorage(_0x248238,path['join'](_0x1884ad['dataDir'],'localStorage.json')),loadSessionStorage(_0x248238,path['join'](_0x1884ad['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Browser\x20state\x20loaded\x20from:\x20'+_0x1884ad['dataDir']);}catch(_0x3c6122){logger_1['logger']['error']('Error\x20loading\x20browser\x20state:\x20'+_0x3c6122['message']);}},'saveBrowserState':async _0x31ac7d=>{try{const _0x270864=config_1['default']['browser'];!fs['existsSync'](_0x270864['dataDir'])&&fs['mkdirSync'](_0x270864['dataDir'],{'recursive':!![]}),await Promise['all']([saveCookies(_0x31ac7d,path['join'](_0x270864['dataDir'],'cookies.json')),saveLocalStorage(_0x31ac7d,path['join'](_0x270864['dataDir'],'localStorage.json')),saveSessionStorage(_0x31ac7d,path['join'](_0x270864['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Complete\x20browser\x20state\x20saved\x20to:\x20'+_0x270864['dataDir']);}catch(_0xd0288f){logger_1['logger']['error']('Error\x20saving\x20browser\x20state:\x20'+_0xd0288f['message']);}},'takeScreenshot':async(_0xe0c7ad,_0x4f42fa,_0x181cf8)=>{try{const _0x2d0613=path['dirname'](_0x4f42fa);!fs['existsSync'](_0x2d0613)&&fs['mkdirSync'](_0x2d0613,{'recursive':!![]}),await _0xe0c7ad['screenshot']({'path':_0x4f42fa,'fullPage':_0x181cf8?.['fullPage']||![]}),logger_1['logger']['info']('Screenshot\x20saved\x20to:\x20'+_0x4f42fa);}catch(_0x53bd6b){logger_1['logger']['error']('Error\x20taking\x20screenshot:\x20'+_0x53bd6b['message']);}},'createCluster':async _0x52810e=>{const _0x4aebf0=config_1['default']['browser'],_0x17a808=Math['max'](0x1,Number(_0x52810e?.['maxConcurrency']||config_1['default']['maxthreads'])||0x1),_0x403e29=await puppeteer_cluster_1['Cluster']['launch']({'concurrency':puppeteer_cluster_1['Cluster']['CONCURRENCY_PAGE'],'maxConcurrency':_0x17a808,'timeout':0x3c*0x3e8,'retryDelay':0x64,'monitor':![],'puppeteerOptions':{'headless':_0x52810e?.['headless']??_0x4aebf0['headless'],'args':['--disable-gpu','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled','--no-sandbox','--disable-setuid-sandbox',..._0x4aebf0['dataDir']?['--user-data-dir='+_0x4aebf0['dataDir']]:[]],'executablePath':_0x4aebf0['executablePath']||undefined,'defaultViewport':{'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}}});return _0x403e29;},'withCluster':async(_0xbc8c8a,_0x518352,_0x3adf9b)=>{const _0x299932=await puppeteerBrowser['createCluster'](_0x3adf9b);try{await _0x299932['task'](async({page:_0xb8ea5e,data:_0x505f56})=>{try{config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0xb8ea5e),await _0xb8ea5e['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1});}catch(_0x25a446){logger_1['logger']['warn']('Cluster\x20page\x20setup\x20failed:\x20'+_0x25a446['message']);}try{return await _0x518352({'page':_0xb8ea5e,'data':_0x505f56});}catch(_0xb6c759){return logger_1['logger']['error']('Task\x20failed\x20for\x20item:\x20'+JSON['stringify'](_0x505f56)+'\x20-\x20'+_0xb6c759['message']),null;}});const _0x4b7981=[];for(const _0x359f45 of _0xbc8c8a){_0x4b7981['push'](_0x299932['execute'](_0x359f45));}const _0x5b37a9=await Promise['allSettled'](_0x4b7981),_0x1e7651=_0x5b37a9['filter'](_0x8ac1ff=>_0x8ac1ff['status']==='fulfilled')['map'](_0x4adc84=>_0x4adc84['value'])['filter'](_0x3c2d7d=>_0x3c2d7d!==null&&_0x3c2d7d!==undefined);return await _0x299932['idle'](),_0x1e7651;}catch(_0x37684e){return logger_1['logger']['error']('Failed\x20to\x20execute\x20cluster:\x20'+_0x37684e['message']),[];}finally{await _0x299932['close']();}}};exports['default']=puppeteerBrowser;