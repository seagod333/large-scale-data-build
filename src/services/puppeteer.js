'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4b89d3,_0x10eba1,_0x2c5616,_0x5cee63){if(_0x5cee63===undefined)_0x5cee63=_0x2c5616;var _0x2921ab=Object['getOwnPropertyDescriptor'](_0x10eba1,_0x2c5616);(!_0x2921ab||('get'in _0x2921ab?!_0x10eba1['__esModule']:_0x2921ab['writable']||_0x2921ab['configurable']))&&(_0x2921ab={'enumerable':!![],'get':function(){return _0x10eba1[_0x2c5616];}}),Object['defineProperty'](_0x4b89d3,_0x5cee63,_0x2921ab);}:function(_0x55ff2a,_0x1f058e,_0x42cf76,_0x4580c4){if(_0x4580c4===undefined)_0x4580c4=_0x42cf76;_0x55ff2a[_0x4580c4]=_0x1f058e[_0x42cf76];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x4526b4,_0x11711e){Object['defineProperty'](_0x4526b4,'default',{'enumerable':!![],'value':_0x11711e});}:function(_0x26677c,_0x5af331){_0x26677c['default']=_0x5af331;}),__importStar=this&&this['__importStar']||function(_0x2b751d){if(_0x2b751d&&_0x2b751d['__esModule'])return _0x2b751d;var _0x406ee1={};if(_0x2b751d!=null){for(var _0x11559c in _0x2b751d)if(_0x11559c!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x2b751d,_0x11559c))__createBinding(_0x406ee1,_0x2b751d,_0x11559c);}return __setModuleDefault(_0x406ee1,_0x2b751d),_0x406ee1;},__importDefault=this&&this['__importDefault']||function(_0x62343c){return _0x62343c&&_0x62343c['__esModule']?_0x62343c:{'default':_0x62343c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require('path')),puppeteer_real_browser_1=__importDefault(require('puppeteer-real-browser')),puppeteer_cluster_1=require('puppeteer-cluster'),utils_1=require('../utils'),logger_1=require('../utils/logger'),customError_1=require('../@types/customError'),config_1=__importDefault(require('../config/config')),viewport={'width':0x640,'height':0x384},setupRequestInterception=async _0x21ad7a=>{try{await _0x21ad7a['setRequestInterception'](!![]),_0x21ad7a['removeAllListeners']('request'),_0x21ad7a['on']('request',_0x5c667a=>{const _0x2a7a27=['image','stylesheet','font'];if(_0x2a7a27['includes'](_0x5c667a['resourceType']()))return _0x5c667a['abort']();return _0x5c667a['continue']();});}catch(_0x4ca870){logger_1['logger']['warn']('Failed\x20to\x20set\x20up\x20request\x20interception:\x20'+_0x4ca870['message']);}},saveCookies=async(_0x11bfce,_0x43d135)=>{try{const _0x3a15ad=await _0x11bfce['cookies'](),_0x3f2b3f=JSON['stringify'](_0x3a15ad,null,0x2),_0x2544f=path['dirname'](_0x43d135);!fs['existsSync'](_0x2544f)&&fs['mkdirSync'](_0x2544f,{'recursive':!![]}),fs['writeFileSync'](_0x43d135,_0x3f2b3f);}catch(_0x4fd03c){logger_1['logger']['error']('Error\x20saving\x20cookies:\x20'+_0x4fd03c['message']);}},loadCookies=async(_0x91c14f,_0x3b980f)=>{try{if(!!fs['existsSync'](_0x3b980f)){const _0xd95d6b=fs['readFileSync'](_0x3b980f,'utf8'),_0x1ac97a=JSON['parse'](_0xd95d6b);await _0x91c14f['setCookie'](..._0x1ac97a);}}catch(_0x2b8dc5){logger_1['logger']['error']('Error\x20loading\x20cookies:\x20'+_0x2b8dc5['message']);}},saveLocalStorage=async(_0x423dbd,_0x1b3ae8)=>{try{const _0x1cdee0=await _0x423dbd['evaluate'](()=>{try{if(typeof window['localStorage']==='undefined')return logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x3b1a16={};for(let _0x11652c=0x0;_0x11652c<window['localStorage']['length'];_0x11652c++){const _0x54c5f9=window['localStorage']['key'](_0x11652c);_0x54c5f9&&(_0x3b1a16[_0x54c5f9]=window['localStorage']['getItem'](_0x54c5f9)||'');}return _0x3b1a16;}catch(_0x7a981d){return logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x7a981d['message']),{};}}),_0x4c190=path['dirname'](_0x1b3ae8);!fs['existsSync'](_0x4c190)&&fs['mkdirSync'](_0x4c190,{'recursive':!![]}),fs['writeFileSync'](_0x1b3ae8,JSON['stringify'](_0x1cdee0,null,0x2));}catch(_0x1d2be2){logger_1['logger']['warn']('Could\x20not\x20save\x20local\x20storage\x20to\x20'+_0x1b3ae8+':\x20'+_0x1d2be2['message']);}},loadLocalStorage=async(_0x4e7ce4,_0x188905)=>{try{if(!!fs['existsSync'](_0x188905)){const _0xbfef49=fs['readFileSync'](_0x188905,'utf8'),_0x3df820=JSON['parse'](_0xbfef49);await _0x4e7ce4['evaluate'](_0x22b683=>{try{if(typeof window['localStorage']==='undefined'){logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x1d5fd8,_0x262fe9]of Object['entries'](_0x22b683)){window['localStorage']['setItem'](_0x1d5fd8,_0x262fe9);}}catch(_0xf861f3){logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0xf861f3['message']);}},_0x3df820);}}catch(_0x532e13){logger_1['logger']['warn']('Could\x20not\x20load\x20local\x20storage\x20from\x20'+_0x188905+':\x20'+_0x532e13['message']);}},saveSessionStorage=async(_0x141503,_0x1da11e)=>{try{const _0x18639d=await _0x141503['evaluate'](()=>{try{if(typeof window['sessionStorage']==='undefined')return logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x14bdac={};for(let _0x546138=0x0;_0x546138<window['sessionStorage']['length'];_0x546138++){const _0x2f70f7=window['sessionStorage']['key'](_0x546138);_0x2f70f7&&(_0x14bdac[_0x2f70f7]=window['sessionStorage']['getItem'](_0x2f70f7)||'');}return _0x14bdac;}catch(_0x56b0bf){return logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x56b0bf['message']),{};}}),_0xadf139=path['dirname'](_0x1da11e);!fs['existsSync'](_0xadf139)&&fs['mkdirSync'](_0xadf139,{'recursive':!![]}),fs['writeFileSync'](_0x1da11e,JSON['stringify'](_0x18639d,null,0x2));}catch(_0x4eac79){logger_1['logger']['warn']('Could\x20not\x20save\x20session\x20storage\x20to\x20'+_0x1da11e+':\x20'+_0x4eac79['message']);}},loadSessionStorage=async(_0x43150d,_0x24806b)=>{try{if(!!fs['existsSync'](_0x24806b)){const _0x5bd7ba=fs['readFileSync'](_0x24806b,'utf8'),_0x196b68=JSON['parse'](_0x5bd7ba);await _0x43150d['evaluate'](_0x3cb84a=>{try{if(typeof window['sessionStorage']==='undefined'){logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x450037,_0x1b0b77]of Object['entries'](_0x3cb84a)){window['sessionStorage']['setItem'](_0x450037,_0x1b0b77);}}catch(_0x3b1776){logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x3b1776['message']);}},_0x196b68);}}catch(_0x11259a){logger_1['logger']['warn']('Could\x20not\x20load\x20session\x20storage\x20from\x20'+_0x24806b+':\x20'+_0x11259a['message']);}},puppeteerBrowser={'getBrowser':async()=>{const _0x36319d=config_1['default']['browser'];_0x36319d['dataDir']&&(!fs['existsSync'](_0x36319d['dataDir'])&&fs['mkdirSync'](_0x36319d['dataDir'],{'recursive':!![]}));const {browser:_0x1505b1,page:_0x10d35e}=await puppeteer_real_browser_1['default']['connect']({'args':['--disable-gpu','--disable-images','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled',..._0x36319d['dataDir']?['--user-data-dir='+_0x36319d['dataDir']]:[]],'headless':_0x36319d['headless'],'customConfig':{},'turnstile':_0x36319d['turnstile'],'connectOption':{'protocolTimeout':0x186a0},'disableXvfb':!![],'ignoreAllFlags':!![]});return await _0x10d35e['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x10d35e),{'browser':_0x1505b1,'page':_0x10d35e};},'getPage':async _0xb08ebe=>{const _0x22f5a1=await _0xb08ebe['newPage']();return await _0x22f5a1['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x22f5a1),_0x22f5a1;},'navigation':async(_0x3e08ca,_0x3a661e,_0x300c5f=0x5)=>{let _0x47159b=0x0,_0x17e0fd=![];while(!_0x17e0fd&&_0x47159b<_0x300c5f){try{await _0x3e08ca['goto'](_0x3a661e,{'waitUntil':'domcontentloaded','timeout':0x1e*0x3e8}),_0x17e0fd=!![];}catch(_0x5378da){_0x47159b++;if(_0x47159b>=_0x300c5f)throw new customError_1['SystemError']('Failed\x20to\x20navigate\x20to\x20'+_0x3a661e+'\x20after\x20'+_0x300c5f+'\x20attempts:\x20'+_0x5378da['message']);else logger_1['logger']['warn']('Navigation\x20attempt\x20'+_0x47159b+'\x20failed:\x20'+_0x5378da['message']+'.\x20Retrying...');await(0x0,utils_1['sleep'])(0x5*0x3e8);}}return _0x17e0fd;},'loadBrowserState':async _0x2f1124=>{try{const _0x369e8b=config_1['default']['browser'];if(!fs['existsSync'](_0x369e8b['dataDir']))throw new customError_1['ValidateError']('directory\x20not\x20found:\x20'+_0x369e8b['dataDir']);await Promise['all']([loadCookies(_0x2f1124,path['join'](_0x369e8b['dataDir'],'cookies.json')),loadLocalStorage(_0x2f1124,path['join'](_0x369e8b['dataDir'],'localStorage.json')),loadSessionStorage(_0x2f1124,path['join'](_0x369e8b['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Browser\x20state\x20loaded\x20from:\x20'+_0x369e8b['dataDir']);}catch(_0x2eabf0){logger_1['logger']['error']('Error\x20loading\x20browser\x20state:\x20'+_0x2eabf0['message']);}},'saveBrowserState':async _0x3f6b2d=>{try{const _0xf23e69=config_1['default']['browser'];!fs['existsSync'](_0xf23e69['dataDir'])&&fs['mkdirSync'](_0xf23e69['dataDir'],{'recursive':!![]}),await Promise['all']([saveCookies(_0x3f6b2d,path['join'](_0xf23e69['dataDir'],'cookies.json')),saveLocalStorage(_0x3f6b2d,path['join'](_0xf23e69['dataDir'],'localStorage.json')),saveSessionStorage(_0x3f6b2d,path['join'](_0xf23e69['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Complete\x20browser\x20state\x20saved\x20to:\x20'+_0xf23e69['dataDir']);}catch(_0x144eae){logger_1['logger']['error']('Error\x20saving\x20browser\x20state:\x20'+_0x144eae['message']);}},'takeScreenshot':async(_0x14f024,_0x39fa60,_0x2cd782)=>{try{const _0x1d924d=path['dirname'](_0x39fa60);!fs['existsSync'](_0x1d924d)&&fs['mkdirSync'](_0x1d924d,{'recursive':!![]}),await _0x14f024['screenshot']({'path':_0x39fa60,'fullPage':_0x2cd782?.['fullPage']||![]}),logger_1['logger']['info']('Screenshot\x20saved\x20to:\x20'+_0x39fa60);}catch(_0x10a365){logger_1['logger']['error']('Error\x20taking\x20screenshot:\x20'+_0x10a365['message']);}},'createCluster':async _0x52d54b=>{const _0x3523fb=config_1['default']['browser'],_0xe32592=Math['max'](0x1,Number(_0x52d54b?.['maxConcurrency']||config_1['default']['maxthreads'])||0x1),_0x505d7f=await puppeteer_cluster_1['Cluster']['launch']({'concurrency':puppeteer_cluster_1['Cluster']['CONCURRENCY_PAGE'],'maxConcurrency':_0xe32592,'timeout':0x3c*0x3e8,'retryDelay':0x64,'monitor':![],'puppeteerOptions':{'headless':_0x52d54b?.['headless']??_0x3523fb['headless'],'args':['--disable-gpu','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled','--no-sandbox','--disable-setuid-sandbox',..._0x3523fb['dataDir']?['--user-data-dir='+_0x3523fb['dataDir']]:[]],'executablePath':_0x3523fb['executablePath']||undefined,'defaultViewport':{'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}}});return _0x505d7f;},'withCluster':async(_0x59bdfb,_0x22d1c6,_0x19748a)=>{const _0x4242bd=await puppeteerBrowser['createCluster'](_0x19748a);try{await _0x4242bd['task'](async({page:_0x5f0b93,data:_0x306ff4})=>{try{config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x5f0b93),await _0x5f0b93['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1});}catch(_0x3b3106){logger_1['logger']['warn']('Cluster\x20page\x20setup\x20failed:\x20'+_0x3b3106['message']);}try{return await _0x22d1c6({'page':_0x5f0b93,'data':_0x306ff4});}catch(_0x185f3c){return logger_1['logger']['error']('Task\x20failed\x20for\x20item:\x20'+JSON['stringify'](_0x306ff4)+'\x20-\x20'+_0x185f3c['message']),null;}});const _0x431a63=[];for(const _0x1dfa4a of _0x59bdfb){_0x431a63['push'](_0x4242bd['execute'](_0x1dfa4a));}const _0xc5405a=await Promise['allSettled'](_0x431a63),_0x33ee92=_0xc5405a['filter'](_0x4531e1=>_0x4531e1['status']==='fulfilled')['map'](_0x3a3be1=>_0x3a3be1['value'])['filter'](_0x2b6dc6=>_0x2b6dc6!==null&&_0x2b6dc6!==undefined);return await _0x4242bd['idle'](),_0x33ee92;}catch(_0x36a828){return logger_1['logger']['error']('Failed\x20to\x20execute\x20cluster:\x20'+_0x36a828['message']),[];}finally{await _0x4242bd['close']();}}};exports['default']=puppeteerBrowser;