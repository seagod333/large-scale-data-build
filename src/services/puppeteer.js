'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x5dcafb,_0xe438d2,_0x27b2e9,_0x28faae){if(_0x28faae===undefined)_0x28faae=_0x27b2e9;var _0x40123b=Object['getOwnPropertyDescriptor'](_0xe438d2,_0x27b2e9);(!_0x40123b||('get'in _0x40123b?!_0xe438d2['__esModule']:_0x40123b['writable']||_0x40123b['configurable']))&&(_0x40123b={'enumerable':!![],'get':function(){return _0xe438d2[_0x27b2e9];}}),Object['defineProperty'](_0x5dcafb,_0x28faae,_0x40123b);}:function(_0x3b9eef,_0x50c9d7,_0x51cacf,_0x338a82){if(_0x338a82===undefined)_0x338a82=_0x51cacf;_0x3b9eef[_0x338a82]=_0x50c9d7[_0x51cacf];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x3fb303,_0x419554){Object['defineProperty'](_0x3fb303,'default',{'enumerable':!![],'value':_0x419554});}:function(_0x3b9040,_0x265380){_0x3b9040['default']=_0x265380;}),__importStar=this&&this['__importStar']||function(_0x492a6f){if(_0x492a6f&&_0x492a6f['__esModule'])return _0x492a6f;var _0xe10af6={};if(_0x492a6f!=null){for(var _0x3e5fb4 in _0x492a6f)if(_0x3e5fb4!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x492a6f,_0x3e5fb4))__createBinding(_0xe10af6,_0x492a6f,_0x3e5fb4);}return __setModuleDefault(_0xe10af6,_0x492a6f),_0xe10af6;},__importDefault=this&&this['__importDefault']||function(_0x40fbde){return _0x40fbde&&_0x40fbde['__esModule']?_0x40fbde:{'default':_0x40fbde};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require('path')),puppeteer_real_browser_1=__importDefault(require('puppeteer-real-browser')),puppeteer_cluster_1=require('puppeteer-cluster'),utils_1=require('../utils'),logger_1=require('../utils/logger'),customError_1=require('../@types/customError'),config_1=__importDefault(require('../config/config')),viewport={'width':0x640,'height':0x384},setupRequestInterception=async _0x1bcdf4=>{try{await _0x1bcdf4['setRequestInterception'](!![]),_0x1bcdf4['removeAllListeners']('request'),_0x1bcdf4['on']('request',_0x5992f4=>{const _0x54ce30=['image','stylesheet','font'];if(_0x54ce30['includes'](_0x5992f4['resourceType']()))return _0x5992f4['abort']();return _0x5992f4['continue']();});}catch(_0x3ed45a){logger_1['logger']['warn']('Failed\x20to\x20set\x20up\x20request\x20interception:\x20'+_0x3ed45a['message']);}},saveCookies=async(_0xe326f3,_0xae2973)=>{try{const _0x1294f8=await _0xe326f3['cookies'](),_0x346265=JSON['stringify'](_0x1294f8,null,0x2),_0x2c301d=path['dirname'](_0xae2973);!fs['existsSync'](_0x2c301d)&&fs['mkdirSync'](_0x2c301d,{'recursive':!![]}),fs['writeFileSync'](_0xae2973,_0x346265);}catch(_0x372177){logger_1['logger']['error']('Error\x20saving\x20cookies:\x20'+_0x372177['message']);}},loadCookies=async(_0x4eb071,_0xf86557)=>{try{if(!!fs['existsSync'](_0xf86557)){const _0x1a3b71=fs['readFileSync'](_0xf86557,'utf8'),_0x1fe822=JSON['parse'](_0x1a3b71);await _0x4eb071['setCookie'](..._0x1fe822);}}catch(_0x17f15e){logger_1['logger']['error']('Error\x20loading\x20cookies:\x20'+_0x17f15e['message']);}},saveLocalStorage=async(_0x5d8e3e,_0x46638e)=>{try{const _0x2007dd=await _0x5d8e3e['evaluate'](()=>{try{if(typeof window['localStorage']==='undefined')return logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x596af7={};for(let _0x403259=0x0;_0x403259<window['localStorage']['length'];_0x403259++){const _0x3997c3=window['localStorage']['key'](_0x403259);_0x3997c3&&(_0x596af7[_0x3997c3]=window['localStorage']['getItem'](_0x3997c3)||'');}return _0x596af7;}catch(_0x4e1ffa){return logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x4e1ffa['message']),{};}}),_0x4efcd0=path['dirname'](_0x46638e);!fs['existsSync'](_0x4efcd0)&&fs['mkdirSync'](_0x4efcd0,{'recursive':!![]}),fs['writeFileSync'](_0x46638e,JSON['stringify'](_0x2007dd,null,0x2));}catch(_0x3bcaff){logger_1['logger']['warn']('Could\x20not\x20save\x20local\x20storage\x20to\x20'+_0x46638e+':\x20'+_0x3bcaff['message']);}},loadLocalStorage=async(_0x59dfc5,_0xb92fb4)=>{try{if(!!fs['existsSync'](_0xb92fb4)){const _0x1608a6=fs['readFileSync'](_0xb92fb4,'utf8'),_0xf47ffd=JSON['parse'](_0x1608a6);await _0x59dfc5['evaluate'](_0x4fefd1=>{try{if(typeof window['localStorage']==='undefined'){logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x32c9cd,_0x239c2b]of Object['entries'](_0x4fefd1)){window['localStorage']['setItem'](_0x32c9cd,_0x239c2b);}}catch(_0x268fd5){logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x268fd5['message']);}},_0xf47ffd);}}catch(_0x3a80db){logger_1['logger']['warn']('Could\x20not\x20load\x20local\x20storage\x20from\x20'+_0xb92fb4+':\x20'+_0x3a80db['message']);}},saveSessionStorage=async(_0x20f456,_0x24ffb0)=>{try{const _0x4595a3=await _0x20f456['evaluate'](()=>{try{if(typeof window['sessionStorage']==='undefined')return logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x3364bf={};for(let _0x15a9ca=0x0;_0x15a9ca<window['sessionStorage']['length'];_0x15a9ca++){const _0x31d316=window['sessionStorage']['key'](_0x15a9ca);_0x31d316&&(_0x3364bf[_0x31d316]=window['sessionStorage']['getItem'](_0x31d316)||'');}return _0x3364bf;}catch(_0xb11e1b){return logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0xb11e1b['message']),{};}}),_0x476ba3=path['dirname'](_0x24ffb0);!fs['existsSync'](_0x476ba3)&&fs['mkdirSync'](_0x476ba3,{'recursive':!![]}),fs['writeFileSync'](_0x24ffb0,JSON['stringify'](_0x4595a3,null,0x2));}catch(_0x46e484){logger_1['logger']['warn']('Could\x20not\x20save\x20session\x20storage\x20to\x20'+_0x24ffb0+':\x20'+_0x46e484['message']);}},loadSessionStorage=async(_0x3de0de,_0x2fc450)=>{try{if(!!fs['existsSync'](_0x2fc450)){const _0x57218d=fs['readFileSync'](_0x2fc450,'utf8'),_0x4f6b69=JSON['parse'](_0x57218d);await _0x3de0de['evaluate'](_0x5a04a5=>{try{if(typeof window['sessionStorage']==='undefined'){logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x21e1b2,_0xefa57]of Object['entries'](_0x5a04a5)){window['sessionStorage']['setItem'](_0x21e1b2,_0xefa57);}}catch(_0x3cec4f){logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x3cec4f['message']);}},_0x4f6b69);}}catch(_0x5b5bd9){logger_1['logger']['warn']('Could\x20not\x20load\x20session\x20storage\x20from\x20'+_0x2fc450+':\x20'+_0x5b5bd9['message']);}},puppeteerBrowser={'getBrowser':async()=>{const _0x349991=config_1['default']['browser'];_0x349991['dataDir']&&(!fs['existsSync'](_0x349991['dataDir'])&&fs['mkdirSync'](_0x349991['dataDir'],{'recursive':!![]}));const {browser:_0x130b48,page:_0x485253}=await puppeteer_real_browser_1['default']['connect']({'args':['--disable-gpu','--disable-images','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled',..._0x349991['dataDir']?['--user-data-dir='+_0x349991['dataDir']]:[]],'headless':_0x349991['headless'],'customConfig':{},'turnstile':_0x349991['turnstile'],'connectOption':{'protocolTimeout':0x186a0},'disableXvfb':!![],'ignoreAllFlags':!![]});return await _0x485253['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x485253),{'browser':_0x130b48,'page':_0x485253};},'getPage':async _0x1b3e81=>{const _0x2fd4ef=await _0x1b3e81['newPage']();return await _0x2fd4ef['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x2fd4ef),_0x2fd4ef;},'navigation':async(_0x15552b,_0x11c115,_0x2a47d8=0x5)=>{let _0xb5bbc2=0x0,_0x44a961=![];while(!_0x44a961&&_0xb5bbc2<_0x2a47d8){try{await _0x15552b['goto'](_0x11c115,{'waitUntil':'domcontentloaded','timeout':0x1e*0x3e8}),_0x44a961=!![];}catch(_0x21cf30){_0xb5bbc2++;if(_0xb5bbc2>=_0x2a47d8)throw new customError_1['SystemError']('Failed\x20to\x20navigate\x20to\x20'+_0x11c115+'\x20after\x20'+_0x2a47d8+'\x20attempts:\x20'+_0x21cf30['message']);else logger_1['logger']['warn']('Navigation\x20attempt\x20'+_0xb5bbc2+'\x20failed:\x20'+_0x21cf30['message']+'.\x20Retrying...');await(0x0,utils_1['sleep'])(0x5*0x3e8);}}return _0x44a961;},'loadBrowserState':async _0x3ba871=>{try{const _0x272934=config_1['default']['browser'];if(!fs['existsSync'](_0x272934['dataDir']))throw new customError_1['ValidateError']('directory\x20not\x20found:\x20'+_0x272934['dataDir']);await Promise['all']([loadCookies(_0x3ba871,path['join'](_0x272934['dataDir'],'cookies.json')),loadLocalStorage(_0x3ba871,path['join'](_0x272934['dataDir'],'localStorage.json')),loadSessionStorage(_0x3ba871,path['join'](_0x272934['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Browser\x20state\x20loaded\x20from:\x20'+_0x272934['dataDir']);}catch(_0x59eb3f){logger_1['logger']['error']('Error\x20loading\x20browser\x20state:\x20'+_0x59eb3f['message']);}},'saveBrowserState':async _0x2f02b8=>{try{const _0x44d822=config_1['default']['browser'];!fs['existsSync'](_0x44d822['dataDir'])&&fs['mkdirSync'](_0x44d822['dataDir'],{'recursive':!![]}),await Promise['all']([saveCookies(_0x2f02b8,path['join'](_0x44d822['dataDir'],'cookies.json')),saveLocalStorage(_0x2f02b8,path['join'](_0x44d822['dataDir'],'localStorage.json')),saveSessionStorage(_0x2f02b8,path['join'](_0x44d822['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Complete\x20browser\x20state\x20saved\x20to:\x20'+_0x44d822['dataDir']);}catch(_0x5dd445){logger_1['logger']['error']('Error\x20saving\x20browser\x20state:\x20'+_0x5dd445['message']);}},'takeScreenshot':async(_0x1e5a7d,_0x428c2b,_0x40bc74)=>{try{const _0x14ec33=path['dirname'](_0x428c2b);!fs['existsSync'](_0x14ec33)&&fs['mkdirSync'](_0x14ec33,{'recursive':!![]}),await _0x1e5a7d['screenshot']({'path':_0x428c2b,'fullPage':_0x40bc74?.['fullPage']||![]}),logger_1['logger']['info']('Screenshot\x20saved\x20to:\x20'+_0x428c2b);}catch(_0xc24fb5){logger_1['logger']['error']('Error\x20taking\x20screenshot:\x20'+_0xc24fb5['message']);}},'createCluster':async _0x4ba22e=>{const _0x598c12=config_1['default']['browser'],_0x58743a=Math['max'](0x1,Number(_0x4ba22e?.['maxConcurrency']||config_1['default']['maxthreads'])||0x1),_0x4ba51=await puppeteer_cluster_1['Cluster']['launch']({'concurrency':puppeteer_cluster_1['Cluster']['CONCURRENCY_PAGE'],'maxConcurrency':_0x58743a,'timeout':0x3c*0x3e8,'retryDelay':0x64,'monitor':![],'puppeteerOptions':{'headless':_0x4ba22e?.['headless']??_0x598c12['headless'],'args':['--disable-gpu','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled','--no-sandbox','--disable-setuid-sandbox',..._0x598c12['dataDir']?['--user-data-dir='+_0x598c12['dataDir']]:[]],'executablePath':_0x598c12['executablePath']||undefined,'defaultViewport':{'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}}});return _0x4ba51;},'withCluster':async(_0x3c6e6b,_0x1af0c7,_0x2a8551)=>{const _0x50aef4=await puppeteerBrowser['createCluster'](_0x2a8551);try{await _0x50aef4['task'](async({page:_0x46bc38,data:_0x54917c})=>{try{config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x46bc38),await _0x46bc38['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1});}catch(_0x4d50a3){logger_1['logger']['warn']('Cluster\x20page\x20setup\x20failed:\x20'+_0x4d50a3['message']);}try{return await _0x1af0c7({'page':_0x46bc38,'data':_0x54917c});}catch(_0x4264d2){return logger_1['logger']['error']('Task\x20failed\x20for\x20item:\x20'+JSON['stringify'](_0x54917c)+'\x20-\x20'+_0x4264d2['message']),null;}});const _0x289fd5=[];for(const _0x3aa555 of _0x3c6e6b){_0x289fd5['push'](_0x50aef4['execute'](_0x3aa555));}const _0x3ec41a=await Promise['allSettled'](_0x289fd5),_0x1e1fdc=_0x3ec41a['filter'](_0x51adb7=>_0x51adb7['status']==='fulfilled')['map'](_0x2ce0bf=>_0x2ce0bf['value'])['filter'](_0x25197d=>_0x25197d!==null&&_0x25197d!==undefined);return await _0x50aef4['idle'](),_0x1e1fdc;}catch(_0x45c6ae){return logger_1['logger']['error']('Failed\x20to\x20execute\x20cluster:\x20'+_0x45c6ae['message']),[];}finally{await _0x50aef4['close']();}}};exports['default']=puppeteerBrowser;