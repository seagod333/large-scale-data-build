'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x1a6cb5,_0x58f843,_0x1e47a4,_0xb3e2bb){if(_0xb3e2bb===undefined)_0xb3e2bb=_0x1e47a4;var _0x15ecc4=Object['getOwnPropertyDescriptor'](_0x58f843,_0x1e47a4);(!_0x15ecc4||('get'in _0x15ecc4?!_0x58f843['__esModule']:_0x15ecc4['writable']||_0x15ecc4['configurable']))&&(_0x15ecc4={'enumerable':!![],'get':function(){return _0x58f843[_0x1e47a4];}}),Object['defineProperty'](_0x1a6cb5,_0xb3e2bb,_0x15ecc4);}:function(_0x2d5d20,_0x16cbb6,_0x1f9623,_0x1b10aa){if(_0x1b10aa===undefined)_0x1b10aa=_0x1f9623;_0x2d5d20[_0x1b10aa]=_0x16cbb6[_0x1f9623];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xd6575e,_0x180224){Object['defineProperty'](_0xd6575e,'default',{'enumerable':!![],'value':_0x180224});}:function(_0x5d24ba,_0x9fa194){_0x5d24ba['default']=_0x9fa194;}),__importStar=this&&this['__importStar']||function(_0x341fc4){if(_0x341fc4&&_0x341fc4['__esModule'])return _0x341fc4;var _0x41a0da={};if(_0x341fc4!=null){for(var _0x128ffa in _0x341fc4)if(_0x128ffa!=='default'&&Object['prototype']['hasOwnProperty']['call'](_0x341fc4,_0x128ffa))__createBinding(_0x41a0da,_0x341fc4,_0x128ffa);}return __setModuleDefault(_0x41a0da,_0x341fc4),_0x41a0da;},__importDefault=this&&this['__importDefault']||function(_0x53b5b4){return _0x53b5b4&&_0x53b5b4['__esModule']?_0x53b5b4:{'default':_0x53b5b4};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fs=__importStar(require('fs')),path=__importStar(require('path')),puppeteer_real_browser_1=__importDefault(require('puppeteer-real-browser')),puppeteer_cluster_1=require('puppeteer-cluster'),utils_1=require('../utils'),logger_1=require('../utils/logger'),customError_1=require('../@types/customError'),config_1=__importDefault(require('../config/config')),viewport={'width':0x640,'height':0x384},setupRequestInterception=async _0x314065=>{try{await _0x314065['setRequestInterception'](!![]),_0x314065['removeAllListeners']('request'),_0x314065['on']('request',_0x3cf5a6=>{const _0x23beee=['image','stylesheet','font'];if(_0x23beee['includes'](_0x3cf5a6['resourceType']()))return _0x3cf5a6['abort']();return _0x3cf5a6['continue']();});}catch(_0x4e538d){logger_1['logger']['warn']('Failed\x20to\x20set\x20up\x20request\x20interception:\x20'+_0x4e538d['message']);}},saveCookies=async(_0x1db28a,_0xbca1a0)=>{try{const _0x3e1d50=await _0x1db28a['cookies'](),_0x534024=JSON['stringify'](_0x3e1d50,null,0x2),_0x3d2b58=path['dirname'](_0xbca1a0);!fs['existsSync'](_0x3d2b58)&&fs['mkdirSync'](_0x3d2b58,{'recursive':!![]}),fs['writeFileSync'](_0xbca1a0,_0x534024);}catch(_0x57d19f){logger_1['logger']['error']('Error\x20saving\x20cookies:\x20'+_0x57d19f['message']);}},loadCookies=async(_0x40d69d,_0x1671d4)=>{try{if(!!fs['existsSync'](_0x1671d4)){const _0x563c62=fs['readFileSync'](_0x1671d4,'utf8'),_0x45465d=JSON['parse'](_0x563c62);await _0x40d69d['setCookie'](..._0x45465d);}}catch(_0x7ac2e8){logger_1['logger']['error']('Error\x20loading\x20cookies:\x20'+_0x7ac2e8['message']);}},saveLocalStorage=async(_0x4e19f4,_0xcfb14f)=>{try{const _0x57b277=await _0x4e19f4['evaluate'](()=>{try{if(typeof window['localStorage']==='undefined')return logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x22cb27={};for(let _0x1caed7=0x0;_0x1caed7<window['localStorage']['length'];_0x1caed7++){const _0x1b8f7b=window['localStorage']['key'](_0x1caed7);_0x1b8f7b&&(_0x22cb27[_0x1b8f7b]=window['localStorage']['getItem'](_0x1b8f7b)||'');}return _0x22cb27;}catch(_0x1d1c4b){return logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x1d1c4b['message']),{};}}),_0x3a0885=path['dirname'](_0xcfb14f);!fs['existsSync'](_0x3a0885)&&fs['mkdirSync'](_0x3a0885,{'recursive':!![]}),fs['writeFileSync'](_0xcfb14f,JSON['stringify'](_0x57b277,null,0x2));}catch(_0x1b8b10){logger_1['logger']['warn']('Could\x20not\x20save\x20local\x20storage\x20to\x20'+_0xcfb14f+':\x20'+_0x1b8b10['message']);}},loadLocalStorage=async(_0x167e39,_0x3e5dce)=>{try{if(!!fs['existsSync'](_0x3e5dce)){const _0x1c0623=fs['readFileSync'](_0x3e5dce,'utf8'),_0x4804dc=JSON['parse'](_0x1c0623);await _0x167e39['evaluate'](_0x3adc08=>{try{if(typeof window['localStorage']==='undefined'){logger_1['logger']['warn']('localStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x1ce399,_0x1175a4]of Object['entries'](_0x3adc08)){window['localStorage']['setItem'](_0x1ce399,_0x1175a4);}}catch(_0x4a6aa8){logger_1['logger']['warn']('Failed\x20to\x20access\x20localStorage:\x20'+_0x4a6aa8['message']);}},_0x4804dc);}}catch(_0x13614c){logger_1['logger']['warn']('Could\x20not\x20load\x20local\x20storage\x20from\x20'+_0x3e5dce+':\x20'+_0x13614c['message']);}},saveSessionStorage=async(_0x4499e1,_0xd9ea30)=>{try{const _0x292e4b=await _0x4499e1['evaluate'](()=>{try{if(typeof window['sessionStorage']==='undefined')return logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page'),{};const _0x5d4462={};for(let _0x480606=0x0;_0x480606<window['sessionStorage']['length'];_0x480606++){const _0x28839b=window['sessionStorage']['key'](_0x480606);_0x28839b&&(_0x5d4462[_0x28839b]=window['sessionStorage']['getItem'](_0x28839b)||'');}return _0x5d4462;}catch(_0x18746b){return logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x18746b['message']),{};}}),_0x4d31da=path['dirname'](_0xd9ea30);!fs['existsSync'](_0x4d31da)&&fs['mkdirSync'](_0x4d31da,{'recursive':!![]}),fs['writeFileSync'](_0xd9ea30,JSON['stringify'](_0x292e4b,null,0x2));}catch(_0x2ee541){logger_1['logger']['warn']('Could\x20not\x20save\x20session\x20storage\x20to\x20'+_0xd9ea30+':\x20'+_0x2ee541['message']);}},loadSessionStorage=async(_0x1932e7,_0x531191)=>{try{if(!!fs['existsSync'](_0x531191)){const _0x7cbe26=fs['readFileSync'](_0x531191,'utf8'),_0x4874ae=JSON['parse'](_0x7cbe26);await _0x1932e7['evaluate'](_0x471b11=>{try{if(typeof window['sessionStorage']==='undefined'){logger_1['logger']['warn']('sessionStorage\x20is\x20not\x20available\x20on\x20this\x20page');return;}for(const [_0x14bdee,_0x309537]of Object['entries'](_0x471b11)){window['sessionStorage']['setItem'](_0x14bdee,_0x309537);}}catch(_0x34403e){logger_1['logger']['warn']('Failed\x20to\x20access\x20sessionStorage:\x20'+_0x34403e['message']);}},_0x4874ae);}}catch(_0x1c4aad){logger_1['logger']['warn']('Could\x20not\x20load\x20session\x20storage\x20from\x20'+_0x531191+':\x20'+_0x1c4aad['message']);}},puppeteerBrowser={'getBrowser':async()=>{const _0x29ddc0=config_1['default']['browser'];_0x29ddc0['dataDir']&&(!fs['existsSync'](_0x29ddc0['dataDir'])&&fs['mkdirSync'](_0x29ddc0['dataDir'],{'recursive':!![]}));const {browser:_0x59e8e8,page:_0x4db2c1}=await puppeteer_real_browser_1['default']['connect']({'args':['--disable-gpu','--disable-images','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled',..._0x29ddc0['dataDir']?['--user-data-dir='+_0x29ddc0['dataDir']]:[]],'headless':_0x29ddc0['headless'],'customConfig':{},'turnstile':_0x29ddc0['turnstile'],'connectOption':{'protocolTimeout':0x186a0},'disableXvfb':!![],'ignoreAllFlags':!![]});return await _0x4db2c1['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x4db2c1),{'browser':_0x59e8e8,'page':_0x4db2c1};},'getPage':async _0x4e6451=>{const _0x5dd571=await _0x4e6451['newPage']();return await _0x5dd571['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}),config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x5dd571),_0x5dd571;},'navigation':async(_0x9ffcb1,_0x34932b,_0x3e5cd9=0x5)=>{let _0x62eb4c=0x0,_0x105809=![];while(!_0x105809&&_0x62eb4c<_0x3e5cd9){try{await _0x9ffcb1['goto'](_0x34932b,{'waitUntil':'domcontentloaded','timeout':0x1e*0x3e8}),_0x105809=!![];}catch(_0x50fcde){_0x62eb4c++;if(_0x62eb4c>=_0x3e5cd9)throw new customError_1['SystemError']('Failed\x20to\x20navigate\x20to\x20'+_0x34932b+'\x20after\x20'+_0x3e5cd9+'\x20attempts:\x20'+_0x50fcde['message']);else logger_1['logger']['warn']('Navigation\x20attempt\x20'+_0x62eb4c+'\x20failed:\x20'+_0x50fcde['message']+'.\x20Retrying...');await(0x0,utils_1['sleep'])(0x5*0x3e8);}}return _0x105809;},'loadBrowserState':async _0x170c40=>{try{const _0x3c7498=config_1['default']['browser'];if(!fs['existsSync'](_0x3c7498['dataDir']))throw new customError_1['ValidateError']('directory\x20not\x20found:\x20'+_0x3c7498['dataDir']);await Promise['all']([loadCookies(_0x170c40,path['join'](_0x3c7498['dataDir'],'cookies.json')),loadLocalStorage(_0x170c40,path['join'](_0x3c7498['dataDir'],'localStorage.json')),loadSessionStorage(_0x170c40,path['join'](_0x3c7498['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Browser\x20state\x20loaded\x20from:\x20'+_0x3c7498['dataDir']);}catch(_0x32fdf2){logger_1['logger']['error']('Error\x20loading\x20browser\x20state:\x20'+_0x32fdf2['message']);}},'saveBrowserState':async _0x3f7ead=>{try{const _0x3f5395=config_1['default']['browser'];!fs['existsSync'](_0x3f5395['dataDir'])&&fs['mkdirSync'](_0x3f5395['dataDir'],{'recursive':!![]}),await Promise['all']([saveCookies(_0x3f7ead,path['join'](_0x3f5395['dataDir'],'cookies.json')),saveLocalStorage(_0x3f7ead,path['join'](_0x3f5395['dataDir'],'localStorage.json')),saveSessionStorage(_0x3f7ead,path['join'](_0x3f5395['dataDir'],'sessionStorage.json'))]),logger_1['logger']['info']('Complete\x20browser\x20state\x20saved\x20to:\x20'+_0x3f5395['dataDir']);}catch(_0x7aaaa7){logger_1['logger']['error']('Error\x20saving\x20browser\x20state:\x20'+_0x7aaaa7['message']);}},'takeScreenshot':async(_0x365a11,_0x395a60,_0x38a2dc)=>{try{const _0x926bc6=path['dirname'](_0x395a60);!fs['existsSync'](_0x926bc6)&&fs['mkdirSync'](_0x926bc6,{'recursive':!![]}),await _0x365a11['screenshot']({'path':_0x395a60,'fullPage':_0x38a2dc?.['fullPage']||![]}),logger_1['logger']['info']('Screenshot\x20saved\x20to:\x20'+_0x395a60);}catch(_0x579201){logger_1['logger']['error']('Error\x20taking\x20screenshot:\x20'+_0x579201['message']);}},'createCluster':async _0x5e7363=>{const _0x859caf=config_1['default']['browser'],_0x1a77cb=Math['max'](0x1,Number(_0x5e7363?.['maxConcurrency']||config_1['default']['maxthreads'])||0x1),_0x281a25=await puppeteer_cluster_1['Cluster']['launch']({'concurrency':puppeteer_cluster_1['Cluster']['CONCURRENCY_PAGE'],'maxConcurrency':_0x1a77cb,'timeout':0x3c*0x3e8,'retryDelay':0x64,'monitor':![],'puppeteerOptions':{'headless':_0x5e7363?.['headless']??_0x859caf['headless'],'args':['--disable-gpu','--disable-plugins','--disable-extensions','--disable-blink-features=AutomationControlled','--no-sandbox','--disable-setuid-sandbox',..._0x859caf['dataDir']?['--user-data-dir='+_0x859caf['dataDir']]:[]],'executablePath':_0x859caf['executablePath']||undefined,'defaultViewport':{'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1}}});return _0x281a25;},'withCluster':async(_0x421dd5,_0x1a72b3,_0x230a63)=>{const _0x30a98d=await puppeteerBrowser['createCluster'](_0x230a63);try{await _0x30a98d['task'](async({page:_0x233e3d,data:_0x455d85})=>{try{config_1['default']['browser']['blockAssets']&&await setupRequestInterception(_0x233e3d),await _0x233e3d['setViewport']({'width':viewport['width'],'height':viewport['height'],'deviceScaleFactor':0x1});}catch(_0x3d129e){logger_1['logger']['warn']('Cluster\x20page\x20setup\x20failed:\x20'+_0x3d129e['message']);}try{return await _0x1a72b3({'page':_0x233e3d,'data':_0x455d85});}catch(_0x4db088){return logger_1['logger']['error']('Task\x20failed\x20for\x20item:\x20'+JSON['stringify'](_0x455d85)+'\x20-\x20'+_0x4db088['message']),null;}});const _0x48e698=[];for(const _0x3c5e35 of _0x421dd5){_0x48e698['push'](_0x30a98d['execute'](_0x3c5e35));}const _0x2cf0d1=await Promise['allSettled'](_0x48e698),_0x5712ba=_0x2cf0d1['filter'](_0x47b83d=>_0x47b83d['status']==='fulfilled')['map'](_0x50b54b=>_0x50b54b['value'])['filter'](_0x2c83a1=>_0x2c83a1!==null&&_0x2c83a1!==undefined);return await _0x30a98d['idle'](),_0x5712ba;}catch(_0x2a6048){return logger_1['logger']['error']('Failed\x20to\x20execute\x20cluster:\x20'+_0x2a6048['message']),[];}finally{await _0x30a98d['close']();}}};exports['default']=puppeteerBrowser;