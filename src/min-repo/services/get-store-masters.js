'use strict';var __importDefault=this&&this['__importDefault']||function(_0x146c7f){return _0x146c7f&&_0x146c7f['__esModule']?_0x146c7f:{'default':_0x146c7f};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),utils_1=require('../../utils'),logger_1=require('../../utils/logger'),baseStoreLink='https://min-repo.com/',getStoreMasters={'getLink':(_0x24169e=0x1,_0xfbb5de='')=>{const _0x22e8de=/^\d{4}-\d{2}-\d{2}$/;return(!_0xfbb5de||!_0x22e8de['test'](_0xfbb5de))&&(_0xfbb5de=(0x0,utils_1['getDateTime'])()),_0x24169e===0x1?baseStoreLink+'?report_date='+_0xfbb5de:baseStoreLink+'page/'+_0x24169e+'/?report_date='+_0xfbb5de;},'getLastPage':async(_0x3f44a3='')=>{try{const _0x7f3c4e=getStoreMasters['getLink'](0x1,_0x3f44a3),[_0x2f8edc]=await puppeteer_1['default']['withCluster']([_0x7f3c4e],async({page:_0x3b4f60,data:_0x50a8c7})=>{await puppeteer_1['default']['navigation'](_0x3b4f60,_0x50a8c7),await _0x3b4f60['waitForSelector']('a.last',{'timeout':0xa*0x3e8});const _0x163789=await _0x3b4f60['evaluate'](()=>{const _0x3ba0dd=document['querySelector']('a.last[aria-label=\x22Last\x20Page\x22]');if(_0x3ba0dd){const _0x1adf5=_0x3ba0dd['getAttribute']('href');if(_0x1adf5){const _0x5e0cd9=_0x1adf5['match'](/\/page\/(\d+)\//);return _0x5e0cd9?parseInt(_0x5e0cd9[0x1],0xa):null;}}return 0x1;});return _0x163789||0x1;});if(!_0x2f8edc)throw new customError_1['ValidateError']('No\x20last\x20page');return logger_1['logger']['info']('Last\x20page\x20number\x20found:\x20'+_0x2f8edc+'.'),_0x2f8edc;}catch(_0x5462a2){logger_1['logger']['error']('Error\x20in\x20getLastPage:\x20'+_0x5462a2['message']);throw new customError_1['ValidateError']('Failed\x20to\x20get\x20last\x20page\x20number:\x20'+_0x5462a2['message']);}},'getPageDatas':async(_0x576cde=0x1,_0x44f790='')=>{try{const _0xfccbc3=getStoreMasters['getLink'](_0x576cde,_0x44f790),[_0x236adf]=await puppeteer_1['default']['withCluster']([_0xfccbc3],async({page:_0x2a84b6,data:_0xbfb2fb})=>{await puppeteer_1['default']['navigation'](_0x2a84b6,_0xbfb2fb),await _0x2a84b6['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x4ffd33=await _0x2a84b6['evaluate'](()=>{const _0x467dd9=[],_0x57bf8a=document['querySelectorAll']('.ichiran_post');return _0x57bf8a['forEach'](_0x43c955=>{try{const _0xb5bfcc=_0x43c955['querySelector']('.ichiran_title\x20a'),_0x3bdc85=_0xb5bfcc?.['getAttribute']('href')||'',_0x349c6b=_0x43c955['querySelector']('.hall_name\x20a'),_0x5d52f3=_0x349c6b?.['textContent']?.['trim']()||'',_0x34272=_0x43c955['querySelector']('.todofuken\x20a'),_0x569c60=_0x34272?.['textContent']?.['trim']()||'';if(_0x3bdc85&&!_0x3bdc85['includes']('example.com')&&_0x5d52f3&&_0x569c60){const _0x9c9b62={'p_name':_0x569c60,'store_name':_0x5d52f3,'store_url':_0x3bdc85};_0x467dd9['push'](_0x9c9b62);}}catch(_0x579383){console['warn']('Error\x20extracting\x20store\x20data:',_0x579383);}}),_0x467dd9;});return _0x4ffd33;});return _0x236adf||[];}catch(_0x116917){return logger_1['logger']['error']('Error\x20loading\x20page\x20'+_0x576cde+':',_0x116917['message']),[];}},'extractStoreMastersPages':async(_0x30efb2,_0x26f313='')=>{try{const _0x3f6e12=Array['from']({'length':_0x30efb2},(_0x196ee4,_0x222e85)=>_0x222e85+0x1),_0xe2625a=await puppeteer_1['default']['withCluster'](_0x3f6e12,async({page:_0x44c211,data:_0x4c6cbf})=>{const _0x1083a4=getStoreMasters['getLink'](_0x4c6cbf,_0x26f313);await puppeteer_1['default']['navigation'](_0x44c211,_0x1083a4),await _0x44c211['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x1ff323=await _0x44c211['evaluate'](()=>{const _0x533d62=[],_0x19e84e=document['querySelectorAll']('.ichiran_post');return _0x19e84e['forEach'](_0x346018=>{try{const _0x2f6a24=_0x346018['querySelector']('.ichiran_title\x20a'),_0x3ddb13=_0x2f6a24?.['getAttribute']('href')||'',_0x1f421b=_0x346018['querySelector']('.hall_name\x20a'),_0x12d724=_0x1f421b?.['textContent']?.['trim']()||'',_0x16f1cf=_0x346018['querySelector']('.todofuken\x20a'),_0x32412b=_0x16f1cf?.['textContent']?.['trim']()||'';if(_0x3ddb13&&!_0x3ddb13['includes']('example.com')&&_0x12d724&&_0x32412b){const _0x599d1f={'p_name':_0x32412b,'store_name':_0x12d724,'store_url':_0x3ddb13};_0x533d62['push'](_0x599d1f);}}catch(_0x3593fc){console['warn']('Error\x20extracting\x20store\x20data:',_0x3593fc);}}),_0x533d62;});return _0x1ff323;}),_0x564ab1=[];for(const _0x5680e of _0xe2625a)if(_0x5680e&&_0x5680e['length'])_0x564ab1['push'](..._0x5680e);return logger_1['logger']['info']('Collected\x20'+_0x564ab1['length']+'\x20store\x20masters\x20from\x20page\x201\x20to\x20'+_0x30efb2+'.'),_0x564ab1;}catch(_0x15ac76){logger_1['logger']['error']('Error\x20in\x20extractStoreMastersPages:\x20'+_0x15ac76['message']);throw new customError_1['SystemError']('Failed\x20to\x20get\x20store\x20master\x20list:\x20'+_0x15ac76['message']);}},'extractData':async(_0x360e54='')=>{try{logger_1['logger']['info']('Getting\x20last\x20page\x20number...');const _0x1ad9e7=await getStoreMasters['getLastPage'](_0x360e54);logger_1['logger']['info']('Extracting\x20store\x20masters\x20from\x201\x20to\x20'+_0x1ad9e7+'...');const _0x5b043d=await getStoreMasters['extractStoreMastersPages'](_0x1ad9e7,_0x360e54);return _0x5b043d;}catch(_0x3b8687){throw new customError_1['ValidateError']('Failed\x20to\x20extract\x20store\x20masters:\x20'+_0x3b8687['message']);}}};exports['default']=getStoreMasters;