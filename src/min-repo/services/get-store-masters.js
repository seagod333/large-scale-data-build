'use strict';var __importDefault=this&&this['__importDefault']||function(_0x444f69){return _0x444f69&&_0x444f69['__esModule']?_0x444f69:{'default':_0x444f69};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),utils_1=require('../../utils'),logger_1=require('../../utils/logger'),baseStoreLink='https://min-repo.com/',getStoreMasters={'getLink':(_0x2b076f=0x1,_0xf87b4a='')=>{const _0x1f11f3=/^\d{4}-\d{2}-\d{2}$/;return(!_0xf87b4a||!_0x1f11f3['test'](_0xf87b4a))&&(_0xf87b4a=(0x0,utils_1['getDateTime'])()),_0x2b076f===0x1?baseStoreLink+'?report_date='+_0xf87b4a:baseStoreLink+'page/'+_0x2b076f+'/?report_date='+_0xf87b4a;},'getLastPage':async(_0x205d08='')=>{try{const _0x241ed2=getStoreMasters['getLink'](0x1,_0x205d08),[_0x231082]=await puppeteer_1['default']['withCluster']([_0x241ed2],async({page:_0x1a697c,data:_0x301120})=>{await puppeteer_1['default']['navigation'](_0x1a697c,_0x301120),await _0x1a697c['waitForSelector']('a.last',{'timeout':0xa*0x3e8});const _0x370054=await _0x1a697c['evaluate'](()=>{const _0xed7ebb=document['querySelector']('a.last[aria-label=\x22Last\x20Page\x22]');if(_0xed7ebb){const _0x1ea271=_0xed7ebb['getAttribute']('href');if(_0x1ea271){const _0x47eb71=_0x1ea271['match'](/\/page\/(\d+)\//);return _0x47eb71?parseInt(_0x47eb71[0x1],0xa):null;}}return 0x1;});return _0x370054||0x1;});if(!_0x231082)throw new customError_1['ValidateError']('No\x20last\x20page');return logger_1['logger']['info']('Last\x20page\x20number\x20found:\x20'+_0x231082+'.'),_0x231082;}catch(_0x38da09){logger_1['logger']['error']('Error\x20in\x20getLastPage:\x20'+_0x38da09['message']);throw new customError_1['ValidateError']('Failed\x20to\x20get\x20last\x20page\x20number:\x20'+_0x38da09['message']);}},'getPageDatas':async(_0x2b779a=0x1,_0x525743='')=>{try{const _0x1f68f0=getStoreMasters['getLink'](_0x2b779a,_0x525743),[_0x13406b]=await puppeteer_1['default']['withCluster']([_0x1f68f0],async({page:_0x1e3a9d,data:_0x1d7f70})=>{await puppeteer_1['default']['navigation'](_0x1e3a9d,_0x1d7f70),await _0x1e3a9d['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x57f434=await _0x1e3a9d['evaluate'](()=>{const _0x127ca6=[],_0x493dbd=document['querySelectorAll']('.ichiran_post');return _0x493dbd['forEach'](_0x338423=>{try{const _0x3cc77c=_0x338423['querySelector']('.ichiran_title\x20a'),_0x3b04ce=_0x3cc77c?.['getAttribute']('href')||'',_0x15f94a=_0x338423['querySelector']('.hall_name\x20a'),_0x576bd8=_0x15f94a?.['textContent']?.['trim']()||'',_0x1f312d=_0x338423['querySelector']('.todofuken\x20a'),_0x2f8554=_0x1f312d?.['textContent']?.['trim']()||'';if(_0x3b04ce&&!_0x3b04ce['includes']('example.com')&&_0x576bd8&&_0x2f8554){const _0x4aa9bc={'p_name':_0x2f8554,'store_name':_0x576bd8,'store_url':_0x3b04ce};_0x127ca6['push'](_0x4aa9bc);}}catch(_0x4b339b){console['warn']('Error\x20extracting\x20store\x20data:',_0x4b339b);}}),_0x127ca6;});return _0x57f434;});return _0x13406b||[];}catch(_0x4f4962){return logger_1['logger']['error']('Error\x20loading\x20page\x20'+_0x2b779a+':',_0x4f4962['message']),[];}},'extractStoreMastersPages':async(_0x19f4bd,_0x421c2f='')=>{try{const _0x805d7=Array['from']({'length':_0x19f4bd},(_0x4ac77d,_0x2f477c)=>_0x2f477c+0x1),_0x2a5f33=await puppeteer_1['default']['withCluster'](_0x805d7,async({page:_0x4ec09d,data:_0x412e88})=>{const _0x2ded0f=getStoreMasters['getLink'](_0x412e88,_0x421c2f);await puppeteer_1['default']['navigation'](_0x4ec09d,_0x2ded0f),await _0x4ec09d['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x529aae=await _0x4ec09d['evaluate'](()=>{const _0x3a8edd=[],_0x4aa202=document['querySelectorAll']('.ichiran_post');return _0x4aa202['forEach'](_0x1e3eb6=>{try{const _0x3739eb=_0x1e3eb6['querySelector']('.ichiran_title\x20a'),_0x2bb6fc=_0x3739eb?.['getAttribute']('href')||'',_0x26ed20=_0x1e3eb6['querySelector']('.hall_name\x20a'),_0x22538e=_0x26ed20?.['textContent']?.['trim']()||'',_0x1aa2f6=_0x1e3eb6['querySelector']('.todofuken\x20a'),_0x3a73f6=_0x1aa2f6?.['textContent']?.['trim']()||'';if(_0x2bb6fc&&!_0x2bb6fc['includes']('example.com')&&_0x22538e&&_0x3a73f6){const _0x199a54={'p_name':_0x3a73f6,'store_name':_0x22538e,'store_url':_0x2bb6fc};_0x3a8edd['push'](_0x199a54);}}catch(_0x2c8dd9){console['warn']('Error\x20extracting\x20store\x20data:',_0x2c8dd9);}}),_0x3a8edd;});return _0x529aae;}),_0x49464e=[];for(const _0x2b5d5a of _0x2a5f33)if(_0x2b5d5a&&_0x2b5d5a['length'])_0x49464e['push'](..._0x2b5d5a);return logger_1['logger']['info']('Collected\x20'+_0x49464e['length']+'\x20store\x20masters\x20from\x20page\x201\x20to\x20'+_0x19f4bd+'.'),_0x49464e;}catch(_0x3e7b12){logger_1['logger']['error']('Error\x20in\x20extractStoreMastersPages:\x20'+_0x3e7b12['message']);throw new customError_1['SystemError']('Failed\x20to\x20get\x20store\x20master\x20list:\x20'+_0x3e7b12['message']);}},'extractData':async(_0x27487e='')=>{try{logger_1['logger']['info']('Getting\x20last\x20page\x20number...');const _0xe20b45=await getStoreMasters['getLastPage'](_0x27487e);logger_1['logger']['info']('Extracting\x20store\x20masters\x20from\x201\x20to\x20'+_0xe20b45+'...');const _0x4333ce=await getStoreMasters['extractStoreMastersPages'](_0xe20b45,_0x27487e);return _0x4333ce;}catch(_0x4bb468){throw new customError_1['ValidateError']('Failed\x20to\x20extract\x20store\x20masters:\x20'+_0x4bb468['message']);}}};exports['default']=getStoreMasters;