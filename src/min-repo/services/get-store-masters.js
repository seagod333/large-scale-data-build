'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5dd788){return _0x5dd788&&_0x5dd788['__esModule']?_0x5dd788:{'default':_0x5dd788};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),utils_1=require('../../utils'),logger_1=require('../../utils/logger'),baseStoreLink='https://min-repo.com/',getStoreMasters={'getLink':(_0x2b3efa=0x1,_0x39ab5b='')=>{const _0x354fe0=/^\d{4}-\d{2}-\d{2}$/;return(!_0x39ab5b||!_0x354fe0['test'](_0x39ab5b))&&(_0x39ab5b=(0x0,utils_1['getDateTime'])()),_0x2b3efa===0x1?baseStoreLink+'?report_date='+_0x39ab5b:baseStoreLink+'page/'+_0x2b3efa+'/?report_date='+_0x39ab5b;},'getLastPage':async(_0x23b457='')=>{try{const _0x17b5b6=getStoreMasters['getLink'](0x1,_0x23b457),[_0x112bba]=await puppeteer_1['default']['withCluster']([_0x17b5b6],async({page:_0x4a75a7,data:_0x562e31})=>{await puppeteer_1['default']['navigation'](_0x4a75a7,_0x562e31),await _0x4a75a7['waitForSelector']('a.last',{'timeout':0xa*0x3e8});const _0x2ce208=await _0x4a75a7['evaluate'](()=>{const _0x358588=document['querySelector']('a.last[aria-label=\x22Last\x20Page\x22]');if(_0x358588){const _0x457be3=_0x358588['getAttribute']('href');if(_0x457be3){const _0x3eaf1a=_0x457be3['match'](/\/page\/(\d+)\//);return _0x3eaf1a?parseInt(_0x3eaf1a[0x1],0xa):null;}}return 0x1;});return _0x2ce208||0x1;});if(!_0x112bba)throw new customError_1['ValidateError']('No\x20last\x20page');return logger_1['logger']['info']('Last\x20page\x20number\x20found:\x20'+_0x112bba+'.'),_0x112bba;}catch(_0x1e8966){logger_1['logger']['error']('Error\x20in\x20getLastPage:\x20'+_0x1e8966['message']);throw new customError_1['ValidateError']('Failed\x20to\x20get\x20last\x20page\x20number:\x20'+_0x1e8966['message']);}},'getPageDatas':async(_0x572d1c=0x1,_0x3fc13c='')=>{try{const _0x11d76e=getStoreMasters['getLink'](_0x572d1c,_0x3fc13c),[_0x115228]=await puppeteer_1['default']['withCluster']([_0x11d76e],async({page:_0x555bdd,data:_0x3e81e1})=>{await puppeteer_1['default']['navigation'](_0x555bdd,_0x3e81e1),await _0x555bdd['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x3f2b80=await _0x555bdd['evaluate'](()=>{const _0x20911b=[],_0x1a31d3=document['querySelectorAll']('.ichiran_post');return _0x1a31d3['forEach'](_0x1e6fe9=>{try{const _0x3aed4b=_0x1e6fe9['querySelector']('.ichiran_title\x20a'),_0x5b20f9=_0x3aed4b?.['getAttribute']('href')||'',_0x3ddc1f=_0x1e6fe9['querySelector']('.hall_name\x20a'),_0xb24b3b=_0x3ddc1f?.['textContent']?.['trim']()||'',_0x4dd2a8=_0x1e6fe9['querySelector']('.todofuken\x20a'),_0x27d895=_0x4dd2a8?.['textContent']?.['trim']()||'';if(_0x5b20f9&&!_0x5b20f9['includes']('example.com')&&_0xb24b3b&&_0x27d895){const _0x100120={'p_name':_0x27d895,'store_name':_0xb24b3b,'store_url':_0x5b20f9};_0x20911b['push'](_0x100120);}}catch(_0x1bbf8f){console['warn']('Error\x20extracting\x20store\x20data:',_0x1bbf8f);}}),_0x20911b;});return _0x3f2b80;});return _0x115228||[];}catch(_0x322426){return logger_1['logger']['error']('Error\x20loading\x20page\x20'+_0x572d1c+':',_0x322426['message']),[];}},'extractStoreMastersPages':async(_0x4a5227,_0x3cb687='')=>{try{const _0x393044=Array['from']({'length':_0x4a5227},(_0x24254e,_0x4ee822)=>_0x4ee822+0x1),_0x1441b2=await puppeteer_1['default']['withCluster'](_0x393044,async({page:_0x545535,data:_0xf1e9ed})=>{const _0x29d22d=getStoreMasters['getLink'](_0xf1e9ed,_0x3cb687);await puppeteer_1['default']['navigation'](_0x545535,_0x29d22d),await _0x545535['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x2dfd9a=await _0x545535['evaluate'](()=>{const _0x3a0da2=[],_0x1b34a9=document['querySelectorAll']('.ichiran_post');return _0x1b34a9['forEach'](_0x4e33af=>{try{const _0x2290b7=_0x4e33af['querySelector']('.ichiran_title\x20a'),_0x4834a7=_0x2290b7?.['getAttribute']('href')||'',_0x58a0f1=_0x4e33af['querySelector']('.hall_name\x20a'),_0x10080d=_0x58a0f1?.['textContent']?.['trim']()||'',_0x34067e=_0x4e33af['querySelector']('.todofuken\x20a'),_0x5a070c=_0x34067e?.['textContent']?.['trim']()||'';if(_0x4834a7&&!_0x4834a7['includes']('example.com')&&_0x10080d&&_0x5a070c){const _0x2f023d={'p_name':_0x5a070c,'store_name':_0x10080d,'store_url':_0x4834a7};_0x3a0da2['push'](_0x2f023d);}}catch(_0x48562b){console['warn']('Error\x20extracting\x20store\x20data:',_0x48562b);}}),_0x3a0da2;});return _0x2dfd9a;}),_0x36c804=[];for(const _0xe3e60 of _0x1441b2)if(_0xe3e60&&_0xe3e60['length'])_0x36c804['push'](..._0xe3e60);return logger_1['logger']['info']('Collected\x20'+_0x36c804['length']+'\x20store\x20masters\x20from\x20page\x201\x20to\x20'+_0x4a5227+'.'),_0x36c804;}catch(_0x4f933a){logger_1['logger']['error']('Error\x20in\x20extractStoreMastersPages:\x20'+_0x4f933a['message']);throw new customError_1['SystemError']('Failed\x20to\x20get\x20store\x20master\x20list:\x20'+_0x4f933a['message']);}},'extractData':async(_0x130ed0='')=>{try{logger_1['logger']['info']('Getting\x20last\x20page\x20number...');const _0x2e1937=await getStoreMasters['getLastPage'](_0x130ed0);logger_1['logger']['info']('Extracting\x20store\x20masters\x20from\x201\x20to\x20'+_0x2e1937+'...');const _0x2fd031=await getStoreMasters['extractStoreMastersPages'](_0x2e1937,_0x130ed0);return _0x2fd031;}catch(_0x44dee8){throw new customError_1['ValidateError']('Failed\x20to\x20extract\x20store\x20masters:\x20'+_0x44dee8['message']);}}};exports['default']=getStoreMasters;