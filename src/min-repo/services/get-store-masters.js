'use strict';var __importDefault=this&&this['__importDefault']||function(_0x521035){return _0x521035&&_0x521035['__esModule']?_0x521035:{'default':_0x521035};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),utils_1=require('../../utils'),logger_1=require('../../utils/logger'),baseStoreLink='https://min-repo.com/',getStoreMasters={'getLink':(_0x748839=0x1,_0xf42ac8='')=>{const _0xe9f7cf=/^\d{4}-\d{2}-\d{2}$/;return(!_0xf42ac8||!_0xe9f7cf['test'](_0xf42ac8))&&(_0xf42ac8=(0x0,utils_1['getDateTime'])()),_0x748839===0x1?baseStoreLink+'?report_date='+_0xf42ac8:baseStoreLink+'page/'+_0x748839+'/?report_date='+_0xf42ac8;},'getLastPage':async(_0x11cad9='')=>{try{const _0x1a692d=getStoreMasters['getLink'](0x1,_0x11cad9),[_0xf01007]=await puppeteer_1['default']['withCluster']([_0x1a692d],async({page:_0x10d60e,data:_0x460146})=>{await puppeteer_1['default']['navigation'](_0x10d60e,_0x460146),await _0x10d60e['waitForSelector']('a.last',{'timeout':0xa*0x3e8});const _0x43b256=await _0x10d60e['evaluate'](()=>{const _0x33a62c=document['querySelector']('a.last[aria-label=\x22Last\x20Page\x22]');if(_0x33a62c){const _0x8e5fe0=_0x33a62c['getAttribute']('href');if(_0x8e5fe0){const _0x517859=_0x8e5fe0['match'](/\/page\/(\d+)\//);return _0x517859?parseInt(_0x517859[0x1],0xa):null;}}return 0x1;});return _0x43b256||0x1;});if(!_0xf01007)throw new customError_1['ValidateError']('No\x20last\x20page');return logger_1['logger']['info']('Last\x20page\x20number\x20found:\x20'+_0xf01007+'.'),_0xf01007;}catch(_0x2cfb3d){logger_1['logger']['error']('Error\x20in\x20getLastPage:\x20'+_0x2cfb3d['message']);throw new customError_1['ValidateError']('Failed\x20to\x20get\x20last\x20page\x20number:\x20'+_0x2cfb3d['message']);}},'getPageDatas':async(_0x110013=0x1,_0x504bd8='')=>{try{const _0x102227=getStoreMasters['getLink'](_0x110013,_0x504bd8),[_0x2f9591]=await puppeteer_1['default']['withCluster']([_0x102227],async({page:_0x5b07bc,data:_0x44ee8b})=>{await puppeteer_1['default']['navigation'](_0x5b07bc,_0x44ee8b),await _0x5b07bc['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x45c1ce=await _0x5b07bc['evaluate'](()=>{const _0x5f0f14=[],_0x5a71ba=document['querySelectorAll']('.ichiran_post');return _0x5a71ba['forEach'](_0x592a3c=>{try{const _0x5b5722=_0x592a3c['querySelector']('.ichiran_title\x20a'),_0x5606cf=_0x5b5722?.['getAttribute']('href')||'',_0x283f33=_0x592a3c['querySelector']('.hall_name\x20a'),_0x14c2ad=_0x283f33?.['textContent']?.['trim']()||'',_0x292d79=_0x592a3c['querySelector']('.todofuken\x20a'),_0x5147c6=_0x292d79?.['textContent']?.['trim']()||'';if(_0x5606cf&&!_0x5606cf['includes']('example.com')&&_0x14c2ad&&_0x5147c6){const _0x29c2e1={'p_name':_0x5147c6,'store_name':_0x14c2ad,'store_url':_0x5606cf};_0x5f0f14['push'](_0x29c2e1);}}catch(_0x214aca){console['warn']('Error\x20extracting\x20store\x20data:',_0x214aca);}}),_0x5f0f14;});return _0x45c1ce;});return _0x2f9591||[];}catch(_0x35c773){return logger_1['logger']['error']('Error\x20loading\x20page\x20'+_0x110013+':',_0x35c773['message']),[];}},'extractStoreMastersPages':async(_0x3f73c1,_0x5b3633='')=>{try{const _0x57dcbf=Array['from']({'length':_0x3f73c1},(_0x3bfc9f,_0xe4b3e0)=>_0xe4b3e0+0x1),_0x2b2199=await puppeteer_1['default']['withCluster'](_0x57dcbf,async({page:_0xcdf09,data:_0x36cb16})=>{const _0x217eda=getStoreMasters['getLink'](_0x36cb16,_0x5b3633);await puppeteer_1['default']['navigation'](_0xcdf09,_0x217eda),await _0xcdf09['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x3bf9e9=await _0xcdf09['evaluate'](()=>{const _0x3fc22e=[],_0x4adeff=document['querySelectorAll']('.ichiran_post');return _0x4adeff['forEach'](_0x22a79e=>{try{const _0x387c59=_0x22a79e['querySelector']('.ichiran_title\x20a'),_0x5e856f=_0x387c59?.['getAttribute']('href')||'',_0x564c80=_0x22a79e['querySelector']('.hall_name\x20a'),_0x48ae6f=_0x564c80?.['textContent']?.['trim']()||'',_0x412d6e=_0x22a79e['querySelector']('.todofuken\x20a'),_0x2fde29=_0x412d6e?.['textContent']?.['trim']()||'';if(_0x5e856f&&!_0x5e856f['includes']('example.com')&&_0x48ae6f&&_0x2fde29){const _0x540743={'p_name':_0x2fde29,'store_name':_0x48ae6f,'store_url':_0x5e856f};_0x3fc22e['push'](_0x540743);}}catch(_0x506749){console['warn']('Error\x20extracting\x20store\x20data:',_0x506749);}}),_0x3fc22e;});return _0x3bf9e9;}),_0x39bad7=[];for(const _0x31b368 of _0x2b2199)if(_0x31b368&&_0x31b368['length'])_0x39bad7['push'](..._0x31b368);return logger_1['logger']['info']('Collected\x20'+_0x39bad7['length']+'\x20store\x20masters\x20from\x20page\x201\x20to\x20'+_0x3f73c1+'.'),_0x39bad7;}catch(_0x2a7603){logger_1['logger']['error']('Error\x20in\x20extractStoreMastersPages:\x20'+_0x2a7603['message']);throw new customError_1['SystemError']('Failed\x20to\x20get\x20store\x20master\x20list:\x20'+_0x2a7603['message']);}},'extractData':async(_0x3277d9='')=>{try{logger_1['logger']['info']('Getting\x20last\x20page\x20number...');const _0x5cdac7=await getStoreMasters['getLastPage'](_0x3277d9);logger_1['logger']['info']('Extracting\x20store\x20masters\x20from\x201\x20to\x20'+_0x5cdac7+'...');const _0x2f0b6f=await getStoreMasters['extractStoreMastersPages'](_0x5cdac7,_0x3277d9);return _0x2f0b6f;}catch(_0x3dfa8d){throw new customError_1['ValidateError']('Failed\x20to\x20extract\x20store\x20masters:\x20'+_0x3dfa8d['message']);}}};exports['default']=getStoreMasters;