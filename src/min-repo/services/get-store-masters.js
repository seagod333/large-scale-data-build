'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4bbb41){return _0x4bbb41&&_0x4bbb41['__esModule']?_0x4bbb41:{'default':_0x4bbb41};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),utils_1=require('../../utils'),logger_1=require('../../utils/logger'),baseStoreLink='https://min-repo.com/',getStoreMasters={'getLink':(_0xcc5409=0x1,_0x7ea1fe='')=>{const _0x267abf=/^\d{4}-\d{2}-\d{2}$/;return(!_0x7ea1fe||!_0x267abf['test'](_0x7ea1fe))&&(_0x7ea1fe=(0x0,utils_1['getDateTime'])()),_0xcc5409===0x1?baseStoreLink+'?report_date='+_0x7ea1fe:baseStoreLink+'page/'+_0xcc5409+'/?report_date='+_0x7ea1fe;},'getLastPage':async(_0x2384b5='')=>{try{const _0x229dfb=getStoreMasters['getLink'](0x1,_0x2384b5),[_0x153910]=await puppeteer_1['default']['withCluster']([_0x229dfb],async({page:_0x1d7923,data:_0x13a4b9})=>{await puppeteer_1['default']['navigation'](_0x1d7923,_0x13a4b9),await _0x1d7923['waitForSelector']('a.last',{'timeout':0xa*0x3e8});const _0x388ee6=await _0x1d7923['evaluate'](()=>{const _0xdee288=document['querySelector']('a.last[aria-label=\x22Last\x20Page\x22]');if(_0xdee288){const _0xe2083f=_0xdee288['getAttribute']('href');if(_0xe2083f){const _0x371961=_0xe2083f['match'](/\/page\/(\d+)\//);return _0x371961?parseInt(_0x371961[0x1],0xa):null;}}return 0x1;});return _0x388ee6||0x1;});if(!_0x153910)throw new customError_1['ValidateError']('No\x20last\x20page');return logger_1['logger']['info']('Last\x20page\x20number\x20found:\x20'+_0x153910+'.'),_0x153910;}catch(_0x114169){logger_1['logger']['error']('Error\x20in\x20getLastPage:\x20'+_0x114169['message']);throw new customError_1['ValidateError']('Failed\x20to\x20get\x20last\x20page\x20number:\x20'+_0x114169['message']);}},'getPageDatas':async(_0x5210ac=0x1,_0x4d0fd4='')=>{try{const _0x1a5268=getStoreMasters['getLink'](_0x5210ac,_0x4d0fd4),[_0x3aee69]=await puppeteer_1['default']['withCluster']([_0x1a5268],async({page:_0x5ba124,data:_0x10b100})=>{await puppeteer_1['default']['navigation'](_0x5ba124,_0x10b100),await _0x5ba124['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x3cf077=await _0x5ba124['evaluate'](()=>{const _0x3777df=[],_0x555e6d=document['querySelectorAll']('.ichiran_post');return _0x555e6d['forEach'](_0x34d0e9=>{try{const _0x3f670e=_0x34d0e9['querySelector']('.ichiran_title\x20a'),_0x1b68d1=_0x3f670e?.['getAttribute']('href')||'',_0x57c6c3=_0x34d0e9['querySelector']('.hall_name\x20a'),_0x3f7d8d=_0x57c6c3?.['textContent']?.['trim']()||'',_0x3bbbd4=_0x34d0e9['querySelector']('.todofuken\x20a'),_0xae27e6=_0x3bbbd4?.['textContent']?.['trim']()||'';if(_0x1b68d1&&!_0x1b68d1['includes']('example.com')&&_0x3f7d8d&&_0xae27e6){const _0x2da2d9={'p_name':_0xae27e6,'store_name':_0x3f7d8d,'store_url':_0x1b68d1};_0x3777df['push'](_0x2da2d9);}}catch(_0x289653){console['warn']('Error\x20extracting\x20store\x20data:',_0x289653);}}),_0x3777df;});return _0x3cf077;});return _0x3aee69||[];}catch(_0x2a5a73){return logger_1['logger']['error']('Error\x20loading\x20page\x20'+_0x5210ac+':',_0x2a5a73['message']),[];}},'extractStoreMastersPages':async(_0x4d141c,_0x18c612='')=>{try{const _0x542163=Array['from']({'length':_0x4d141c},(_0x968b6c,_0xac5b00)=>_0xac5b00+0x1),_0x34a699=await puppeteer_1['default']['withCluster'](_0x542163,async({page:_0x4bd237,data:_0x3b522b})=>{const _0x1c4ab4=getStoreMasters['getLink'](_0x3b522b,_0x18c612);await puppeteer_1['default']['navigation'](_0x4bd237,_0x1c4ab4),await _0x4bd237['waitForSelector']('.site-content',{'timeout':0xa*0x3e8});const _0x941c14=await _0x4bd237['evaluate'](()=>{const _0x5ab5c2=[],_0x3ea434=document['querySelectorAll']('.ichiran_post');return _0x3ea434['forEach'](_0xede583=>{try{const _0x367641=_0xede583['querySelector']('.ichiran_title\x20a'),_0x314607=_0x367641?.['getAttribute']('href')||'',_0x20ccc9=_0xede583['querySelector']('.hall_name\x20a'),_0x576ca8=_0x20ccc9?.['textContent']?.['trim']()||'',_0x11f224=_0xede583['querySelector']('.todofuken\x20a'),_0x456808=_0x11f224?.['textContent']?.['trim']()||'';if(_0x314607&&!_0x314607['includes']('example.com')&&_0x576ca8&&_0x456808){const _0x21d2fb={'p_name':_0x456808,'store_name':_0x576ca8,'store_url':_0x314607};_0x5ab5c2['push'](_0x21d2fb);}}catch(_0x4ff420){console['warn']('Error\x20extracting\x20store\x20data:',_0x4ff420);}}),_0x5ab5c2;});return _0x941c14;}),_0xc91fff=[];for(const _0x2797d4 of _0x34a699)if(_0x2797d4&&_0x2797d4['length'])_0xc91fff['push'](..._0x2797d4);return logger_1['logger']['info']('Collected\x20'+_0xc91fff['length']+'\x20store\x20masters\x20from\x20page\x201\x20to\x20'+_0x4d141c+'.'),_0xc91fff;}catch(_0x2f073d){logger_1['logger']['error']('Error\x20in\x20extractStoreMastersPages:\x20'+_0x2f073d['message']);throw new customError_1['SystemError']('Failed\x20to\x20get\x20store\x20master\x20list:\x20'+_0x2f073d['message']);}},'extractData':async(_0x247078='')=>{try{logger_1['logger']['info']('Getting\x20last\x20page\x20number...');const _0x559586=await getStoreMasters['getLastPage'](_0x247078);logger_1['logger']['info']('Extracting\x20store\x20masters\x20from\x201\x20to\x20'+_0x559586+'...');const _0x2e6539=await getStoreMasters['extractStoreMastersPages'](_0x559586,_0x247078);return _0x2e6539;}catch(_0x225fb7){throw new customError_1['ValidateError']('Failed\x20to\x20extract\x20store\x20masters:\x20'+_0x225fb7['message']);}}};exports['default']=getStoreMasters;