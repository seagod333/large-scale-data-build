'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4a4e56){return _0x4a4e56&&_0x4a4e56['__esModule']?_0x4a4e56:{'default':_0x4a4e56};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),logger_1=require('../../utils/logger'),getDailySlotData={'getUrl':(_0x36aed5,_0xd5d69b)=>{const _0x91e42f=new URLSearchParams({'kishu':_0xd5d69b})['toString']();return _0x36aed5+'?'+_0x91e42f;},'getModelNames':async(_0x5d9a91,_0x2f4504)=>{try{const _0x524a84=await puppeteer_1['default']['withCluster'](_0x5d9a91,async({page:_0x1080aa,data:_0x5116c0})=>{try{await puppeteer_1['default']['navigation'](_0x1080aa,_0x5116c0['store_url']),await _0x1080aa['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8}),await _0x1080aa['waitForSelector']('.site-content\x20ul.tab',{'timeout':0x1e*0x3e8}),await _0x1080aa['evaluate'](()=>{const _0x2f349b=document['querySelector']('ul.tab');if(!_0x2f349b)return![];const _0x51831b=_0x2f349b['querySelectorAll']('li');Array['from'](_0x51831b)['some'](_0x34d9b6=>{if(_0x34d9b6['textContent']&&_0x34d9b6['textContent']['trim']()==='機種別')return _0x34d9b6['click'](),!![];return![];});}),await _0x1080aa['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8});const _0x21d716=await _0x1080aa['evaluate']((_0x4474b1,_0x46d99f,_0x1750ec,_0x4897e9)=>{const _0x668931=document['querySelector']('.site-content\x20.tab_content');if(!_0x668931)return[];const _0x115241=Array['from'](_0x668931['querySelectorAll']('table.kishu\x20tbody\x20tr')),_0x241c7c=[];for(const _0x1e10d3 of _0x115241){if(_0x1e10d3['querySelector']('th'))continue;const _0x5da7ef=_0x1e10d3['querySelector']('td\x20a');if(!_0x5da7ef)continue;const _0x51f9a1=(_0x5da7ef['textContent']||'')['trim']();if(!_0x51f9a1)continue;_0x241c7c['push']({'date':_0x4474b1,'machine_name':_0x51f9a1,'p_name':_0x46d99f,'store_name':_0x1750ec,'store_url':_0x4897e9});}return _0x241c7c;},_0x2f4504,_0x5116c0['p_name'],_0x5116c0['store_name'],_0x5116c0['store_url']);return logger_1['logger']['info']('Completed\x20extracting\x20model\x20names\x20for\x20store:\x20'+_0x5116c0['store_name']+'\x20('+_0x5116c0['p_name']+')\x20-\x20found\x20'+_0x21d716['length']+'\x20models'),_0x21d716;}catch(_0x4887c7){return logger_1['logger']['error']('Failed\x20to\x20get\x20model\x20names\x20for\x20store\x20'+(_0x5116c0?.['store_name']||'')+':\x20'+_0x4887c7['message']),null;}}),_0x1fcfef=[];for(const _0x4471cc of _0x524a84)if(_0x4471cc&&_0x4471cc['length'])_0x1fcfef['push'](..._0x4471cc);return _0x1fcfef;}catch(_0xf92c32){return logger_1['logger']['error']('Failed\x20to\x20get\x20daily\x20slot\x20URLs:\x20'+_0xf92c32['message']),[];}},'getPageDatas':async(_0x5e7521,_0x275cc6)=>{try{const _0x5bfeb6=getDailySlotData['getUrl'](_0x275cc6['store_url'],_0x275cc6['machine_name']);await puppeteer_1['default']['navigation'](_0x5e7521,_0x5bfeb6),await _0x5e7521['waitForSelector']('.site-content',{'timeout':0x1e*0x3e8}),await _0x5e7521['evaluate'](()=>{const _0x2b1fb9=document['querySelector']('ul.tab');if(!_0x2b1fb9)return;const _0x903195=Array['from'](_0x2b1fb9['querySelectorAll']('li')),_0x4594f5=_0x903195['find'](_0x560ba8=>(_0x560ba8['textContent']||'')['trim']()==='データ一覧');if(_0x4594f5)_0x4594f5['click']();}),await _0x5e7521['waitForSelector']('.tab_content',{'timeout':0x1e*0x3e8});const _0x3c4d72=await _0x5e7521['evaluate']((_0x9f9365,_0x248f3d,_0x3c7482,_0x5f231a)=>{const _0x4e9c61=[],_0x5af49e=Array['from'](document['querySelectorAll']('.tab_content')),_0x4529b4=_0x5af49e['find'](_0x208aed=>{const _0x1e16d1=(_0x208aed['querySelector']('h2')?.['textContent']||'')['trim']();return _0x1e16d1['includes']('データ一覧');});if(!_0x4529b4)return _0x4e9c61;const _0x5bd521=_0x4529b4['querySelector']('table');if(!_0x5bd521)return _0x4e9c61;const _0x402a39=Array['from']((_0x5bd521['querySelector']('thead\x20tr')||_0x5bd521['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x2f286a=_0x402a39['map'](_0x29073f=>(_0x29073f['textContent']||'')['trim']()),_0xd8f22c={};_0x2f286a['forEach']((_0x1bce64,_0x1569be)=>{_0xd8f22c[_0x1bce64]=_0x1569be;});const _0x10e895=_0xd8f22c['台番']??0x0,_0x43eec6=_0xd8f22c['差枚'],_0x38d373=_0xd8f22c['G数']??0x1,_0x3032fc=_0xd8f22c['出率'],_0x122345=_0xd8f22c['BB']??0x2,_0x5be426=_0xd8f22c['RB']??0x3,_0x23e600=_0xd8f22c['合成']??0x4,_0x2c73f6=_0xd8f22c['BB率'],_0x3adac3=_0xd8f22c['RB率'],_0x32e905=Array['from'](_0x5bd521['querySelectorAll']('tbody\x20tr'));for(const _0x249e07 of _0x32e905){if(_0x249e07['querySelector']('th'))continue;if(_0x249e07['classList']['contains']('avg_row'))continue;const _0x17f9dc=Array['from'](_0x249e07['querySelectorAll']('td'));if(!_0x17f9dc['length'])continue;const _0x15cbc5=_0x17f9dc[_0x10e895]?.['querySelector']('a'),_0x5ea740=(_0x15cbc5?.['textContent']||'')['trim'](),_0x4f05ce=_0x15cbc5?.['href']||'',_0x5af1cc=_0x43eec6!==undefined?(_0x17f9dc[_0x43eec6]?.['textContent']||'')['trim']():'-',_0x52cc1c=(_0x17f9dc[_0x38d373]?.['textContent']||'')['trim'](),_0x3966ac=_0x3032fc!==undefined?(_0x17f9dc[_0x3032fc]?.['textContent']||'')['trim']():'-',_0x21b1f8=(_0x17f9dc[_0x122345]?.['textContent']||'')['trim'](),_0x2b39f8=(_0x17f9dc[_0x5be426]?.['textContent']||'')['trim'](),_0x255bd5=(_0x17f9dc[_0x23e600]?.['textContent']||'')['trim'](),_0x39045f=_0x2c73f6!==undefined?(_0x17f9dc[_0x2c73f6]?.['textContent']||'')['trim']():'-',_0xa262b3=_0x3adac3!==undefined?(_0x17f9dc[_0x3adac3]?.['textContent']||'')['trim']():'-';if(!_0x5ea740)continue;_0x4e9c61['push']({'date':_0x9f9365,'machine_name':_0x248f3d,'p_name':_0x3c7482,'store_name':_0x5f231a,'machine_number':_0x5ea740,'credit_difference':_0x5af1cc,'game_count':_0x52cc1c,'payout_rate':_0x3966ac,'bb':_0x21b1f8,'rb':_0x2b39f8,'synthesis':_0x255bd5,'bb_rate':_0x39045f,'rb_rate':_0xa262b3,'data_url':_0x4f05ce});}return _0x4e9c61;},_0x275cc6['date'],_0x275cc6['machine_name'],_0x275cc6['p_name'],_0x275cc6['store_name']);return _0x3c4d72;}catch(_0x2229d3){return logger_1['logger']['error']('Failed\x20to\x20get\x20page\x20data\x20for\x20model\x20'+_0x275cc6['machine_name']+':\x20'+_0x2229d3['message']),[];}},'getslotData':async _0x2cfbfa=>{try{const _0x2460b8=await puppeteer_1['default']['withCluster'](_0x2cfbfa,async({page:_0x96d587,data:_0x4170e7})=>{try{const _0x1be994=getDailySlotData['getUrl'](_0x4170e7['store_url'],_0x4170e7['machine_name']);await puppeteer_1['default']['navigation'](_0x96d587,_0x1be994),await _0x96d587['waitForSelector']('.site-content',{'timeout':0xa*0x3e8}),await _0x96d587['evaluate'](()=>{const _0x588ec8=document['querySelector']('ul.tab');if(!_0x588ec8)return;const _0x4ce982=Array['from'](_0x588ec8['querySelectorAll']('li')),_0x3e4def=_0x4ce982['find'](_0x23c2d1=>(_0x23c2d1['textContent']||'')['trim']()==='データ一覧');if(_0x3e4def)_0x3e4def['click']();}),await _0x96d587['waitForSelector']('.tab_content',{'timeout':0xa*0x3e8});const _0x49b604=await _0x96d587['evaluate']((_0x59ba70,_0x3026f4,_0x506d0e,_0xc40924)=>{const _0x16fb72=[],_0x51e3a2=Array['from'](document['querySelectorAll']('.tab_content')),_0x6863b=_0x51e3a2['find'](_0x2c84ed=>{const _0x5727ea=(_0x2c84ed['querySelector']('h2')?.['textContent']||'')['trim']();return _0x5727ea['includes']('データ一覧');});if(!_0x6863b)return _0x16fb72;const _0x9b65de=_0x6863b['querySelector']('table');if(!_0x9b65de)return _0x16fb72;const _0x56d841=Array['from']((_0x9b65de['querySelector']('thead\x20tr')||_0x9b65de['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x1457d4=_0x56d841['map'](_0x4b8c7e=>(_0x4b8c7e['textContent']||'')['trim']()),_0x1ab559={};_0x1457d4['forEach']((_0x23a702,_0x384099)=>{_0x1ab559[_0x23a702]=_0x384099;});const _0x36ba64=_0x1ab559['台番']??0x0,_0x4d4dba=_0x1ab559['差枚'],_0x542185=_0x1ab559['G数']??0x1,_0x37ada1=_0x1ab559['出率'],_0x1013d6=_0x1ab559['BB']??0x2,_0x184c4e=_0x1ab559['RB']??0x3,_0x320846=_0x1ab559['合成']??0x4,_0x3fb4aa=_0x1ab559['BB率'],_0x489fd9=_0x1ab559['RB率'],_0x4580a6=Array['from'](_0x9b65de['querySelectorAll']('tbody\x20tr'));for(const _0x189ebd of _0x4580a6){if(_0x189ebd['querySelector']('th'))continue;if(_0x189ebd['classList']['contains']('avg_row'))continue;const _0x2c7eed=Array['from'](_0x189ebd['querySelectorAll']('td'));if(!_0x2c7eed['length'])continue;const _0x54bda5=_0x2c7eed[_0x36ba64]?.['querySelector']('a'),_0x7d693f=(_0x54bda5?.['textContent']||'')['trim'](),_0x48d6ee=_0x54bda5?.['href']||'',_0x718631=_0x4d4dba!==undefined?(_0x2c7eed[_0x4d4dba]?.['textContent']||'')['trim']():'-',_0x5b8f9d=(_0x2c7eed[_0x542185]?.['textContent']||'')['trim'](),_0x5cbdde=_0x37ada1!==undefined?(_0x2c7eed[_0x37ada1]?.['textContent']||'')['trim']():'-',_0x56d324=(_0x2c7eed[_0x1013d6]?.['textContent']||'')['trim'](),_0x2518af=(_0x2c7eed[_0x184c4e]?.['textContent']||'')['trim'](),_0x9a9fda=(_0x2c7eed[_0x320846]?.['textContent']||'')['trim'](),_0x28b0b8=_0x3fb4aa!==undefined?(_0x2c7eed[_0x3fb4aa]?.['textContent']||'')['trim']():'-',_0x1758f3=_0x489fd9!==undefined?(_0x2c7eed[_0x489fd9]?.['textContent']||'')['trim']():'-';if(!_0x7d693f)continue;_0x16fb72['push']({'date':_0x59ba70,'machine_name':_0x3026f4,'p_name':_0x506d0e,'store_name':_0xc40924,'machine_number':_0x7d693f,'credit_difference':_0x718631,'game_count':_0x5b8f9d,'payout_rate':_0x5cbdde,'bb':_0x56d324,'rb':_0x2518af,'synthesis':_0x9a9fda,'bb_rate':_0x28b0b8,'rb_rate':_0x1758f3,'data_url':_0x48d6ee});}return _0x16fb72;},_0x4170e7['date'],_0x4170e7['machine_name'],_0x4170e7['p_name'],_0x4170e7['store_name']);return logger_1['logger']['info']('Extracted\x20'+(_0x49b604?.['length']||0x0)+'\x20slot\x20data\x20rows\x20for\x20model:\x20'+_0x4170e7['machine_name']+',\x20store:\x20'+_0x4170e7['store_name']),_0x49b604||[];}catch(_0x30587d){return logger_1['logger']['error']('getslotData\x20error\x20for\x20model\x20'+_0x4170e7?.['machine_name']+':\x20'+_0x30587d['message']),null;}}),_0x812a8f=[];for(const _0x4ec0b2 of _0x2460b8)if(_0x4ec0b2&&_0x4ec0b2['length'])_0x812a8f['push'](..._0x4ec0b2);return logger_1['logger']['info']('getslotData\x20completed:\x20Total\x20slot\x20rows\x20collected:\x20'+_0x812a8f['length']),_0x812a8f;}catch(_0x11358a){return logger_1['logger']['error']('getslotData\x20failed:\x20'+_0x11358a['message']),[];}},'extraDatas':async(_0x23a665,_0x44120d)=>{try{logger_1['logger']['info']('Starting\x20extraction\x20of\x20machine\x20models\x20for\x20'+_0x23a665['length']+'\x20stores\x20on\x20'+_0x44120d+'...');const _0x1952eb=await getDailySlotData['getModelNames'](_0x23a665,_0x44120d);logger_1['logger']['info']('Successfully\x20extracted\x20'+_0x1952eb['length']+'\x20machine\x20models.\x20Now\x20extracting\x20slot\x20data...');const _0x544a35=await getDailySlotData['getslotData'](_0x1952eb);return logger_1['logger']['info']('Extraction\x20complete!\x20Collected\x20'+_0x544a35['length']+'\x20slot\x20data\x20rows\x20for\x20'+_0x1952eb['length']+'\x20models.'),[_0x1952eb,_0x544a35];}catch(_0x4c06e7){logger_1['logger']['error']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0x4c06e7['message']);throw new customError_1['SystemError']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0x4c06e7['message']);}}};exports['default']=getDailySlotData;