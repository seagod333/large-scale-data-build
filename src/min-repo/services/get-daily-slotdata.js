'use strict';var __importDefault=this&&this['__importDefault']||function(_0x188394){return _0x188394&&_0x188394['__esModule']?_0x188394:{'default':_0x188394};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),logger_1=require('../../utils/logger'),getDailySlotData={'getUrl':(_0x14f493,_0x5817a9)=>{const _0x17dd0b=new URLSearchParams({'kishu':_0x5817a9})['toString']();return _0x14f493+'?'+_0x17dd0b;},'getModelNames':async(_0x389ea9,_0x3ab0f2)=>{try{const _0x489902=await puppeteer_1['default']['withCluster'](_0x389ea9,async({page:_0x492f36,data:_0x469f2c})=>{try{await puppeteer_1['default']['navigation'](_0x492f36,_0x469f2c['store_url']),await _0x492f36['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8}),await _0x492f36['waitForSelector']('.site-content\x20ul.tab',{'timeout':0x1e*0x3e8}),await _0x492f36['evaluate'](()=>{const _0x146acf=document['querySelector']('ul.tab');if(!_0x146acf)return![];const _0x2cb1b8=_0x146acf['querySelectorAll']('li');Array['from'](_0x2cb1b8)['some'](_0x3c6322=>{if(_0x3c6322['textContent']&&_0x3c6322['textContent']['trim']()==='機種別')return _0x3c6322['click'](),!![];return![];});}),await _0x492f36['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8});const _0x3a16a3=await _0x492f36['evaluate']((_0x210758,_0x52dae1,_0x53328c,_0x2ec41a)=>{const _0x2783cc=document['querySelector']('.site-content\x20.tab_content');if(!_0x2783cc)return[];const _0x2856e8=Array['from'](_0x2783cc['querySelectorAll']('table.kishu\x20tbody\x20tr')),_0x5e4db5=[];for(const _0x26cf2b of _0x2856e8){if(_0x26cf2b['querySelector']('th'))continue;const _0x339ff7=_0x26cf2b['querySelector']('td\x20a');if(!_0x339ff7)continue;const _0x58780e=(_0x339ff7['textContent']||'')['trim']();if(!_0x58780e)continue;_0x5e4db5['push']({'date':_0x210758,'machine_name':_0x58780e,'p_name':_0x52dae1,'store_name':_0x53328c,'store_url':_0x2ec41a});}return _0x5e4db5;},_0x3ab0f2,_0x469f2c['p_name'],_0x469f2c['store_name'],_0x469f2c['store_url']);return logger_1['logger']['info']('Completed\x20extracting\x20model\x20names\x20for\x20store:\x20'+_0x469f2c['store_name']+'\x20('+_0x469f2c['p_name']+')\x20-\x20found\x20'+_0x3a16a3['length']+'\x20models'),_0x3a16a3;}catch(_0x56a176){return logger_1['logger']['error']('Failed\x20to\x20get\x20model\x20names\x20for\x20store\x20'+(_0x469f2c?.['store_name']||'')+':\x20'+_0x56a176['message']),null;}}),_0x15cef1=[];for(const _0xc23ecd of _0x489902)if(_0xc23ecd&&_0xc23ecd['length'])_0x15cef1['push'](..._0xc23ecd);return _0x15cef1;}catch(_0x57e5d1){return logger_1['logger']['error']('Failed\x20to\x20get\x20daily\x20slot\x20URLs:\x20'+_0x57e5d1['message']),[];}},'getPageDatas':async(_0x4f04a5,_0x3cd605)=>{try{const _0x42dff0=getDailySlotData['getUrl'](_0x3cd605['store_url'],_0x3cd605['machine_name']);await puppeteer_1['default']['navigation'](_0x4f04a5,_0x42dff0),await _0x4f04a5['waitForSelector']('.site-content',{'timeout':0x1e*0x3e8}),await _0x4f04a5['evaluate'](()=>{const _0x2ab7dd=document['querySelector']('ul.tab');if(!_0x2ab7dd)return;const _0x2aeb6c=Array['from'](_0x2ab7dd['querySelectorAll']('li')),_0x43abb6=_0x2aeb6c['find'](_0x37aca0=>(_0x37aca0['textContent']||'')['trim']()==='データ一覧');if(_0x43abb6)_0x43abb6['click']();}),await _0x4f04a5['waitForSelector']('.tab_content',{'timeout':0x1e*0x3e8});const _0x4f563b=await _0x4f04a5['evaluate']((_0x5c9a27,_0x41724c,_0x3c6d34,_0x4c6636)=>{const _0x141c4c=[],_0x30791d=Array['from'](document['querySelectorAll']('.tab_content')),_0x54851b=_0x30791d['find'](_0x3cd811=>{const _0x2065e7=(_0x3cd811['querySelector']('h2')?.['textContent']||'')['trim']();return _0x2065e7['includes']('データ一覧');});if(!_0x54851b)return _0x141c4c;const _0x4b16db=_0x54851b['querySelector']('table');if(!_0x4b16db)return _0x141c4c;const _0x49a536=Array['from']((_0x4b16db['querySelector']('thead\x20tr')||_0x4b16db['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x2d8cf1=_0x49a536['map'](_0x595171=>(_0x595171['textContent']||'')['trim']()),_0x51d747={};_0x2d8cf1['forEach']((_0x200a14,_0x26871b)=>{_0x51d747[_0x200a14]=_0x26871b;});const _0x246491=_0x51d747['台番']??0x0,_0x2a8359=_0x51d747['差枚'],_0x5ca906=_0x51d747['G数']??0x1,_0x38093d=_0x51d747['出率'],_0x2a211f=_0x51d747['BB']??0x2,_0x2a073f=_0x51d747['RB']??0x3,_0x3c3cba=_0x51d747['合成']??0x4,_0x1203df=_0x51d747['BB率'],_0x80cd14=_0x51d747['RB率'],_0x1c8161=Array['from'](_0x4b16db['querySelectorAll']('tbody\x20tr'));for(const _0x3cbd83 of _0x1c8161){if(_0x3cbd83['querySelector']('th'))continue;if(_0x3cbd83['classList']['contains']('avg_row'))continue;const _0x1f4bb0=Array['from'](_0x3cbd83['querySelectorAll']('td'));if(!_0x1f4bb0['length'])continue;const _0x229aba=_0x1f4bb0[_0x246491]?.['querySelector']('a'),_0x18251c=(_0x229aba?.['textContent']||'')['trim'](),_0x544c60=_0x229aba?.['href']||'',_0x2b6649=_0x2a8359!==undefined?(_0x1f4bb0[_0x2a8359]?.['textContent']||'')['trim']():'-',_0x4a709d=(_0x1f4bb0[_0x5ca906]?.['textContent']||'')['trim'](),_0x5e96a2=_0x38093d!==undefined?(_0x1f4bb0[_0x38093d]?.['textContent']||'')['trim']():'-',_0x3242ad=(_0x1f4bb0[_0x2a211f]?.['textContent']||'')['trim'](),_0xfdb05c=(_0x1f4bb0[_0x2a073f]?.['textContent']||'')['trim'](),_0x56601b=(_0x1f4bb0[_0x3c3cba]?.['textContent']||'')['trim'](),_0x74f5ce=_0x1203df!==undefined?(_0x1f4bb0[_0x1203df]?.['textContent']||'')['trim']():'-',_0x447ff5=_0x80cd14!==undefined?(_0x1f4bb0[_0x80cd14]?.['textContent']||'')['trim']():'-';if(!_0x18251c)continue;_0x141c4c['push']({'date':_0x5c9a27,'machine_name':_0x41724c,'p_name':_0x3c6d34,'store_name':_0x4c6636,'machine_number':_0x18251c,'credit_difference':_0x2b6649,'game_count':_0x4a709d,'payout_rate':_0x5e96a2,'bb':_0x3242ad,'rb':_0xfdb05c,'synthesis':_0x56601b,'bb_rate':_0x74f5ce,'rb_rate':_0x447ff5,'data_url':_0x544c60});}return _0x141c4c;},_0x3cd605['date'],_0x3cd605['machine_name'],_0x3cd605['p_name'],_0x3cd605['store_name']);return _0x4f563b;}catch(_0xba858a){return logger_1['logger']['error']('Failed\x20to\x20get\x20page\x20data\x20for\x20model\x20'+_0x3cd605['machine_name']+':\x20'+_0xba858a['message']),[];}},'getslotData':async _0x72e38e=>{try{const _0x123f86=await puppeteer_1['default']['withCluster'](_0x72e38e,async({page:_0x3ced18,data:_0x5693b4})=>{try{const _0xf2fe78=getDailySlotData['getUrl'](_0x5693b4['store_url'],_0x5693b4['machine_name']);await puppeteer_1['default']['navigation'](_0x3ced18,_0xf2fe78),await _0x3ced18['waitForSelector']('.site-content',{'timeout':0xa*0x3e8}),await _0x3ced18['evaluate'](()=>{const _0x4b3138=document['querySelector']('ul.tab');if(!_0x4b3138)return;const _0x78e2ab=Array['from'](_0x4b3138['querySelectorAll']('li')),_0x5c593a=_0x78e2ab['find'](_0x7621a3=>(_0x7621a3['textContent']||'')['trim']()==='データ一覧');if(_0x5c593a)_0x5c593a['click']();}),await _0x3ced18['waitForSelector']('.tab_content',{'timeout':0xa*0x3e8});const _0x3b3b31=await _0x3ced18['evaluate']((_0x2d5f8c,_0x326025,_0x3b54d7,_0x40f6b8)=>{const _0x423b36=[],_0x31de48=Array['from'](document['querySelectorAll']('.tab_content')),_0x4a18cf=_0x31de48['find'](_0x4f92eb=>{const _0x30ae99=(_0x4f92eb['querySelector']('h2')?.['textContent']||'')['trim']();return _0x30ae99['includes']('データ一覧');});if(!_0x4a18cf)return _0x423b36;const _0x1f9e3c=_0x4a18cf['querySelector']('table');if(!_0x1f9e3c)return _0x423b36;const _0x575c1f=Array['from']((_0x1f9e3c['querySelector']('thead\x20tr')||_0x1f9e3c['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x12f417=_0x575c1f['map'](_0x5bb627=>(_0x5bb627['textContent']||'')['trim']()),_0x1ed9e6={};_0x12f417['forEach']((_0x218970,_0x1f788b)=>{_0x1ed9e6[_0x218970]=_0x1f788b;});const _0x2bb193=_0x1ed9e6['台番']??0x0,_0x2f5351=_0x1ed9e6['差枚'],_0x1f6c25=_0x1ed9e6['G数']??0x1,_0xad7165=_0x1ed9e6['出率'],_0x5df57b=_0x1ed9e6['BB']??0x2,_0x3041c8=_0x1ed9e6['RB']??0x3,_0x5df519=_0x1ed9e6['合成']??0x4,_0x353f21=_0x1ed9e6['BB率'],_0x17818f=_0x1ed9e6['RB率'],_0x36082c=Array['from'](_0x1f9e3c['querySelectorAll']('tbody\x20tr'));for(const _0x487698 of _0x36082c){if(_0x487698['querySelector']('th'))continue;if(_0x487698['classList']['contains']('avg_row'))continue;const _0x3e7ca8=Array['from'](_0x487698['querySelectorAll']('td'));if(!_0x3e7ca8['length'])continue;const _0x1be6de=_0x3e7ca8[_0x2bb193]?.['querySelector']('a'),_0x46748d=(_0x1be6de?.['textContent']||'')['trim'](),_0x5ecd0a=_0x1be6de?.['href']||'',_0x506a4d=_0x2f5351!==undefined?(_0x3e7ca8[_0x2f5351]?.['textContent']||'')['trim']():'-',_0x3250df=(_0x3e7ca8[_0x1f6c25]?.['textContent']||'')['trim'](),_0x53888e=_0xad7165!==undefined?(_0x3e7ca8[_0xad7165]?.['textContent']||'')['trim']():'-',_0x4bbbf6=(_0x3e7ca8[_0x5df57b]?.['textContent']||'')['trim'](),_0x3daeb0=(_0x3e7ca8[_0x3041c8]?.['textContent']||'')['trim'](),_0xb2fbc=(_0x3e7ca8[_0x5df519]?.['textContent']||'')['trim'](),_0x501def=_0x353f21!==undefined?(_0x3e7ca8[_0x353f21]?.['textContent']||'')['trim']():'-',_0x49a2fd=_0x17818f!==undefined?(_0x3e7ca8[_0x17818f]?.['textContent']||'')['trim']():'-';if(!_0x46748d)continue;_0x423b36['push']({'date':_0x2d5f8c,'machine_name':_0x326025,'p_name':_0x3b54d7,'store_name':_0x40f6b8,'machine_number':_0x46748d,'credit_difference':_0x506a4d,'game_count':_0x3250df,'payout_rate':_0x53888e,'bb':_0x4bbbf6,'rb':_0x3daeb0,'synthesis':_0xb2fbc,'bb_rate':_0x501def,'rb_rate':_0x49a2fd,'data_url':_0x5ecd0a});}return _0x423b36;},_0x5693b4['date'],_0x5693b4['machine_name'],_0x5693b4['p_name'],_0x5693b4['store_name']);return logger_1['logger']['info']('Extracted\x20'+(_0x3b3b31?.['length']||0x0)+'\x20slot\x20data\x20rows\x20for\x20model:\x20'+_0x5693b4['machine_name']+',\x20store:\x20'+_0x5693b4['store_name']),_0x3b3b31||[];}catch(_0x2eb6b1){return logger_1['logger']['error']('getslotData\x20error\x20for\x20model\x20'+_0x5693b4?.['machine_name']+':\x20'+_0x2eb6b1['message']),null;}}),_0x3cfeb8=[];for(const _0x40c277 of _0x123f86)if(_0x40c277&&_0x40c277['length'])_0x3cfeb8['push'](..._0x40c277);return logger_1['logger']['info']('getslotData\x20completed:\x20Total\x20slot\x20rows\x20collected:\x20'+_0x3cfeb8['length']),_0x3cfeb8;}catch(_0x1a148a){return logger_1['logger']['error']('getslotData\x20failed:\x20'+_0x1a148a['message']),[];}},'extraDatas':async(_0x3eec44,_0x3cca5f)=>{try{logger_1['logger']['info']('Starting\x20extraction\x20of\x20machine\x20models\x20for\x20'+_0x3eec44['length']+'\x20stores\x20on\x20'+_0x3cca5f+'...');const _0x109ca3=await getDailySlotData['getModelNames'](_0x3eec44,_0x3cca5f);logger_1['logger']['info']('Successfully\x20extracted\x20'+_0x109ca3['length']+'\x20machine\x20models.\x20Now\x20extracting\x20slot\x20data...');const _0x1bfb8a=await getDailySlotData['getslotData'](_0x109ca3);return logger_1['logger']['info']('Extraction\x20complete!\x20Collected\x20'+_0x1bfb8a['length']+'\x20slot\x20data\x20rows\x20for\x20'+_0x109ca3['length']+'\x20models.'),[_0x109ca3,_0x1bfb8a];}catch(_0x14ad76){logger_1['logger']['error']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0x14ad76['message']);throw new customError_1['SystemError']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0x14ad76['message']);}}};exports['default']=getDailySlotData;