'use strict';var __importDefault=this&&this['__importDefault']||function(_0xaaaa40){return _0xaaaa40&&_0xaaaa40['__esModule']?_0xaaaa40:{'default':_0xaaaa40};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const puppeteer_1=__importDefault(require('../../services/puppeteer')),customError_1=require('../../@types/customError'),logger_1=require('../../utils/logger'),getDailySlotData={'getUrl':(_0x529205,_0xb87895)=>{const _0x17d59=new URLSearchParams({'kishu':_0xb87895})['toString']();return _0x529205+'?'+_0x17d59;},'getModelNames':async(_0x1c4011,_0x2f71ab)=>{try{const _0x56c1ff=await puppeteer_1['default']['withCluster'](_0x1c4011,async({page:_0x3c0a01,data:_0x14f2ad})=>{try{await puppeteer_1['default']['navigation'](_0x3c0a01,_0x14f2ad['store_url']),await _0x3c0a01['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8}),await _0x3c0a01['waitForSelector']('.site-content\x20ul.tab',{'timeout':0x1e*0x3e8}),await _0x3c0a01['evaluate'](()=>{const _0x21a1f2=document['querySelector']('ul.tab');if(!_0x21a1f2)return![];const _0x24ea46=_0x21a1f2['querySelectorAll']('li');Array['from'](_0x24ea46)['some'](_0x22e0ab=>{if(_0x22e0ab['textContent']&&_0x22e0ab['textContent']['trim']()==='機種別')return _0x22e0ab['click'](),!![];return![];});}),await _0x3c0a01['waitForSelector']('.site-content\x20.tab_content',{'timeout':0x1e*0x3e8});const _0x22bb27=await _0x3c0a01['evaluate']((_0x542f5b,_0x4992df,_0x46515d,_0x10f945)=>{const _0x5d3114=document['querySelector']('.site-content\x20.tab_content');if(!_0x5d3114)return[];const _0x560ab3=Array['from'](_0x5d3114['querySelectorAll']('table.kishu\x20tbody\x20tr')),_0x258848=[];for(const _0xa55c26 of _0x560ab3){if(_0xa55c26['querySelector']('th'))continue;const _0x57e328=_0xa55c26['querySelector']('td\x20a');if(!_0x57e328)continue;const _0x3136b8=(_0x57e328['textContent']||'')['trim']();if(!_0x3136b8)continue;_0x258848['push']({'date':_0x542f5b,'machine_name':_0x3136b8,'p_name':_0x4992df,'store_name':_0x46515d,'store_url':_0x10f945});}return _0x258848;},_0x2f71ab,_0x14f2ad['p_name'],_0x14f2ad['store_name'],_0x14f2ad['store_url']);return logger_1['logger']['info']('Completed\x20extracting\x20model\x20names\x20for\x20store:\x20'+_0x14f2ad['store_name']+'\x20('+_0x14f2ad['p_name']+')\x20-\x20found\x20'+_0x22bb27['length']+'\x20models'),_0x22bb27;}catch(_0x3438cd){return logger_1['logger']['error']('Failed\x20to\x20get\x20model\x20names\x20for\x20store\x20'+(_0x14f2ad?.['store_name']||'')+':\x20'+_0x3438cd['message']),null;}}),_0x8ef3f6=[];for(const _0x2c2ff7 of _0x56c1ff)if(_0x2c2ff7&&_0x2c2ff7['length'])_0x8ef3f6['push'](..._0x2c2ff7);return _0x8ef3f6;}catch(_0x106e14){return logger_1['logger']['error']('Failed\x20to\x20get\x20daily\x20slot\x20URLs:\x20'+_0x106e14['message']),[];}},'getPageDatas':async(_0xbf854,_0x2ac592)=>{try{const _0x40c774=getDailySlotData['getUrl'](_0x2ac592['store_url'],_0x2ac592['machine_name']);await puppeteer_1['default']['navigation'](_0xbf854,_0x40c774),await _0xbf854['waitForSelector']('.site-content',{'timeout':0x1e*0x3e8}),await _0xbf854['evaluate'](()=>{const _0xb74343=document['querySelector']('ul.tab');if(!_0xb74343)return;const _0x38cb76=Array['from'](_0xb74343['querySelectorAll']('li')),_0x44f6d1=_0x38cb76['find'](_0x2e6420=>(_0x2e6420['textContent']||'')['trim']()==='データ一覧');if(_0x44f6d1)_0x44f6d1['click']();}),await _0xbf854['waitForSelector']('.tab_content',{'timeout':0x1e*0x3e8});const _0x2bc0cd=await _0xbf854['evaluate']((_0x1b6b3d,_0x1fb2da,_0x2168d6,_0x5ca854)=>{const _0x185393=[],_0x3885cb=Array['from'](document['querySelectorAll']('.tab_content')),_0x5dd403=_0x3885cb['find'](_0x5c3bcc=>{const _0x5063b1=(_0x5c3bcc['querySelector']('h2')?.['textContent']||'')['trim']();return _0x5063b1['includes']('データ一覧');});if(!_0x5dd403)return _0x185393;const _0xe1ac19=_0x5dd403['querySelector']('table');if(!_0xe1ac19)return _0x185393;const _0x5c9852=Array['from']((_0xe1ac19['querySelector']('thead\x20tr')||_0xe1ac19['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x5f2514=_0x5c9852['map'](_0x968591=>(_0x968591['textContent']||'')['trim']()),_0x117651={};_0x5f2514['forEach']((_0x141577,_0x41c667)=>{_0x117651[_0x141577]=_0x41c667;});const _0x166283=_0x117651['台番']??0x0,_0x40a171=_0x117651['差枚'],_0x581915=_0x117651['G数']??0x1,_0x101b17=_0x117651['出率'],_0x490c25=_0x117651['BB']??0x2,_0x2046ae=_0x117651['RB']??0x3,_0x369bb1=_0x117651['合成']??0x4,_0x469838=_0x117651['BB率'],_0x1dbb10=_0x117651['RB率'],_0x155575=Array['from'](_0xe1ac19['querySelectorAll']('tbody\x20tr'));for(const _0x1eb966 of _0x155575){if(_0x1eb966['querySelector']('th'))continue;if(_0x1eb966['classList']['contains']('avg_row'))continue;const _0x299450=Array['from'](_0x1eb966['querySelectorAll']('td'));if(!_0x299450['length'])continue;const _0x4cbdd6=_0x299450[_0x166283]?.['querySelector']('a'),_0x3d2160=(_0x4cbdd6?.['textContent']||'')['trim'](),_0x49d141=_0x4cbdd6?.['href']||'',_0x44aa6f=_0x40a171!==undefined?(_0x299450[_0x40a171]?.['textContent']||'')['trim']():'-',_0x46d860=(_0x299450[_0x581915]?.['textContent']||'')['trim'](),_0x1ecebf=_0x101b17!==undefined?(_0x299450[_0x101b17]?.['textContent']||'')['trim']():'-',_0x5bf6f7=(_0x299450[_0x490c25]?.['textContent']||'')['trim'](),_0x2ee99e=(_0x299450[_0x2046ae]?.['textContent']||'')['trim'](),_0x4a43ef=(_0x299450[_0x369bb1]?.['textContent']||'')['trim'](),_0x6ffd29=_0x469838!==undefined?(_0x299450[_0x469838]?.['textContent']||'')['trim']():'-',_0x50f0c0=_0x1dbb10!==undefined?(_0x299450[_0x1dbb10]?.['textContent']||'')['trim']():'-';if(!_0x3d2160)continue;_0x185393['push']({'date':_0x1b6b3d,'machine_name':_0x1fb2da,'p_name':_0x2168d6,'store_name':_0x5ca854,'machine_number':_0x3d2160,'credit_difference':_0x44aa6f,'game_count':_0x46d860,'payout_rate':_0x1ecebf,'bb':_0x5bf6f7,'rb':_0x2ee99e,'synthesis':_0x4a43ef,'bb_rate':_0x6ffd29,'rb_rate':_0x50f0c0,'data_url':_0x49d141});}return _0x185393;},_0x2ac592['date'],_0x2ac592['machine_name'],_0x2ac592['p_name'],_0x2ac592['store_name']);return _0x2bc0cd;}catch(_0x4dd56f){return logger_1['logger']['error']('Failed\x20to\x20get\x20page\x20data\x20for\x20model\x20'+_0x2ac592['machine_name']+':\x20'+_0x4dd56f['message']),[];}},'getslotData':async _0x4b0695=>{try{const _0x5bcdf4=await puppeteer_1['default']['withCluster'](_0x4b0695,async({page:_0x430530,data:_0x291755})=>{try{const _0x51609c=getDailySlotData['getUrl'](_0x291755['store_url'],_0x291755['machine_name']);await puppeteer_1['default']['navigation'](_0x430530,_0x51609c),await _0x430530['waitForSelector']('.site-content',{'timeout':0xa*0x3e8}),await _0x430530['evaluate'](()=>{const _0x306f52=document['querySelector']('ul.tab');if(!_0x306f52)return;const _0x5c9c3c=Array['from'](_0x306f52['querySelectorAll']('li')),_0x259f7f=_0x5c9c3c['find'](_0xaeb882=>(_0xaeb882['textContent']||'')['trim']()==='データ一覧');if(_0x259f7f)_0x259f7f['click']();}),await _0x430530['waitForSelector']('.tab_content',{'timeout':0xa*0x3e8});const _0x195f4f=await _0x430530['evaluate']((_0x506d1a,_0xa4dfc0,_0x28bcd2,_0x56ddd6)=>{const _0x374827=[],_0x5e8e6f=Array['from'](document['querySelectorAll']('.tab_content')),_0x5e9950=_0x5e8e6f['find'](_0x44c2e6=>{const _0x3df367=(_0x44c2e6['querySelector']('h2')?.['textContent']||'')['trim']();return _0x3df367['includes']('データ一覧');});if(!_0x5e9950)return _0x374827;const _0x43eaa0=_0x5e9950['querySelector']('table');if(!_0x43eaa0)return _0x374827;const _0x52d570=Array['from']((_0x43eaa0['querySelector']('thead\x20tr')||_0x43eaa0['querySelector']('tbody\x20tr'))?.['querySelectorAll']('th')||[]),_0x35a234=_0x52d570['map'](_0x17b685=>(_0x17b685['textContent']||'')['trim']()),_0x33e759={};_0x35a234['forEach']((_0x3628e7,_0x214d90)=>{_0x33e759[_0x3628e7]=_0x214d90;});const _0x5c93af=_0x33e759['台番']??0x0,_0x33ac6d=_0x33e759['差枚'],_0x4255fb=_0x33e759['G数']??0x1,_0x392336=_0x33e759['出率'],_0x518314=_0x33e759['BB']??0x2,_0x549d1c=_0x33e759['RB']??0x3,_0x525998=_0x33e759['合成']??0x4,_0x1fe534=_0x33e759['BB率'],_0x3b161e=_0x33e759['RB率'],_0x5b6425=Array['from'](_0x43eaa0['querySelectorAll']('tbody\x20tr'));for(const _0x225c94 of _0x5b6425){if(_0x225c94['querySelector']('th'))continue;if(_0x225c94['classList']['contains']('avg_row'))continue;const _0x153ab7=Array['from'](_0x225c94['querySelectorAll']('td'));if(!_0x153ab7['length'])continue;const _0x22bbf9=_0x153ab7[_0x5c93af]?.['querySelector']('a'),_0x541691=(_0x22bbf9?.['textContent']||'')['trim'](),_0x156664=_0x22bbf9?.['href']||'',_0x3622ef=_0x33ac6d!==undefined?(_0x153ab7[_0x33ac6d]?.['textContent']||'')['trim']():'-',_0x4a1284=(_0x153ab7[_0x4255fb]?.['textContent']||'')['trim'](),_0x5cf0e9=_0x392336!==undefined?(_0x153ab7[_0x392336]?.['textContent']||'')['trim']():'-',_0x408be2=(_0x153ab7[_0x518314]?.['textContent']||'')['trim'](),_0x587d94=(_0x153ab7[_0x549d1c]?.['textContent']||'')['trim'](),_0x31b53c=(_0x153ab7[_0x525998]?.['textContent']||'')['trim'](),_0x26a44a=_0x1fe534!==undefined?(_0x153ab7[_0x1fe534]?.['textContent']||'')['trim']():'-',_0x43fd00=_0x3b161e!==undefined?(_0x153ab7[_0x3b161e]?.['textContent']||'')['trim']():'-';if(!_0x541691)continue;_0x374827['push']({'date':_0x506d1a,'machine_name':_0xa4dfc0,'p_name':_0x28bcd2,'store_name':_0x56ddd6,'machine_number':_0x541691,'credit_difference':_0x3622ef,'game_count':_0x4a1284,'payout_rate':_0x5cf0e9,'bb':_0x408be2,'rb':_0x587d94,'synthesis':_0x31b53c,'bb_rate':_0x26a44a,'rb_rate':_0x43fd00,'data_url':_0x156664});}return _0x374827;},_0x291755['date'],_0x291755['machine_name'],_0x291755['p_name'],_0x291755['store_name']);return logger_1['logger']['info']('Extracted\x20'+(_0x195f4f?.['length']||0x0)+'\x20slot\x20data\x20rows\x20for\x20model:\x20'+_0x291755['machine_name']+',\x20store:\x20'+_0x291755['store_name']),_0x195f4f||[];}catch(_0x457c59){return logger_1['logger']['error']('getslotData\x20error\x20for\x20model\x20'+_0x291755?.['machine_name']+':\x20'+_0x457c59['message']),null;}}),_0xeac7be=[];for(const _0x48d0fc of _0x5bcdf4)if(_0x48d0fc&&_0x48d0fc['length'])_0xeac7be['push'](..._0x48d0fc);return logger_1['logger']['info']('getslotData\x20completed:\x20Total\x20slot\x20rows\x20collected:\x20'+_0xeac7be['length']),_0xeac7be;}catch(_0xd31b7){return logger_1['logger']['error']('getslotData\x20failed:\x20'+_0xd31b7['message']),[];}},'extraDatas':async(_0x3fc7e8,_0x273861)=>{try{logger_1['logger']['info']('Starting\x20extraction\x20of\x20machine\x20models\x20for\x20'+_0x3fc7e8['length']+'\x20stores\x20on\x20'+_0x273861+'...');const _0x469661=await getDailySlotData['getModelNames'](_0x3fc7e8,_0x273861);logger_1['logger']['info']('Successfully\x20extracted\x20'+_0x469661['length']+'\x20machine\x20models.\x20Now\x20extracting\x20slot\x20data...');const _0x18588c=await getDailySlotData['getslotData'](_0x469661);return logger_1['logger']['info']('Extraction\x20complete!\x20Collected\x20'+_0x18588c['length']+'\x20slot\x20data\x20rows\x20for\x20'+_0x469661['length']+'\x20models.'),[_0x469661,_0x18588c];}catch(_0xad1afd){logger_1['logger']['error']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0xad1afd['message']);throw new customError_1['SystemError']('Failed\x20to\x20extract\x20daily\x20slot\x20data:\x20'+_0xad1afd['message']);}}};exports['default']=getDailySlotData;